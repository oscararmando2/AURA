<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AURA STUDIO - Pilates a tu medida</title>
    <!-- Google Fonts - Amita -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amita:wght@400;700&display=swap" rel="stylesheet">
    <!-- Google Fonts - Fondamento -->
    <link href="https://fonts.googleapis.com/css2?family=Fondamento:ital@0;1&display=swap" rel="stylesheet">
    <!-- FullCalendar v6.1.15 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css" rel="stylesheet">
    <!-- Mercado Pago SDK v2 - Para Checkout Pro en Producción -->
    <script src="https://sdk.mercadopago.com/js/v2"></script>
    <!-- Firebase SDK v10 via CDN - Authentication and Firestore -->
    <script type="module">
        // Firebase imports will be handled in the script section
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #ffffff;
            scroll-behavior: smooth;
        }

        /* ========== Page Loader ========== */
        #page-loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 1;
            transition: opacity 0.5s ease-out;
        }

        #page-loader.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        .loader-content {
            width: 300px;
            height: 300px;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .loader-content .planet {
            width: 65%;
            height: 65%;
            background-color: #EFE9E1;
            border-radius: 100%;
            position: absolute;
            display: flex;
            align-items: center;
            transform-origin: center center;
            box-shadow: inset 2px -10px 0px rgba(0, 0, 0, 0.1);
            animation: planet 5s ease infinite alternate;
        }

        @keyframes planet {
            0% {
                transform: rotate(10deg);
            }
            100% {
                transform: rotate(-10deg);
            }
        }



        .loader-content .planet .spots {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            z-index: 2;
        }

        .loader-content .planet .spots span {
            width: 30px;
            height: 30px;
            background-color: #EFE9E1;
            position: absolute;
            border-radius: 100%;
            box-shadow: inset -2px 3px 0px rgba(0, 0, 0, 0.3);
            animation: dots 5s ease infinite alternate;
        }

        @keyframes dots {
            0% {
                box-shadow: inset -3px 3px 0px rgba(0, 0, 0, 0.3);
            }
            100% {
                box-shadow: inset 3px 3px 0px rgba(0, 0, 0, 0.3);
            }
        }

        .loader-content .planet .spots span:nth-child(1) {
            top: 20px;
            right: 50px;
        }

        .loader-content .planet .spots span:nth-child(2) {
            top: 40px;
            left: 50px;
            width: 15px;
            height: 15px;
        }

        .loader-content .planet .spots span:nth-child(3) {
            top: 80px;
            left: 20px;
            width: 25px;
            height: 25px;
        }

        .loader-content .planet .spots span:nth-child(4) {
            top: 80px;
            left: 90px;
            width: 40px;
            height: 40px;
        }

        .loader-content .planet .spots span:nth-child(5) {
            top: 160px;
            left: 70px;
            width: 15px;
            height: 15px;
        }

        .loader-content .planet .spots span:nth-child(6) {
            top: 165px;
            left: 125px;
            width: 10px;
            height: 10px;
        }

        .loader-content .planet .spots span:nth-child(7) {
            top: 90px;
            left: 150px;
            width: 15px;
            height: 15px;
        }

        .loader-content p {
            color: #EFE9E1;
            font-size: 14px;
            z-index: 2;
            position: absolute;
            bottom: -20px;
            font-family: "Roboto Mono", monospace;
            animation: text 4s ease infinite;
            width: 100px;
            text-align: center;
        }

        @keyframes text {
            0% {
                transform: translateX(-30px);
                letter-spacing: 0px;
                color: #EFE9E1;
            }
            25% {
                letter-spacing: 3px;
                color: #EFE9E1;
            }
            50% {
                transform: translateX(30px);
                letter-spacing: 0px;
                color: #EFE9E1;
            }
            75% {
                letter-spacing: 3px;
                color: #EFE9E1;
            }
            100% {
                transform: translateX(-30px);
                letter-spacing: 0px;
                color: #EFE9E1;
            }
        }

        /* Responsive adjustments for mobile */
        @media (max-width: 768px) {
            .loader-content {
                width: 250px;
                height: 250px;
            }

            /* Make moon bigger on tablet */
            .loader-content .planet {
                width: 75%;
                height: 75%;
            }

            /* Adjust spot positions for tablet to stay within moon */
            .loader-content .planet .spots span:nth-child(1) {
                top: 18px;
                right: 45px;
            }

            .loader-content .planet .spots span:nth-child(2) {
                top: 35px;
                left: 45px;
            }

            .loader-content .planet .spots span:nth-child(3) {
                top: 70px;
                left: 18px;
            }

            .loader-content .planet .spots span:nth-child(4) {
                top: 75px;
                left: 80px;
            }

            .loader-content .planet .spots span:nth-child(5) {
                top: 140px;
                left: 60px;
            }

            .loader-content .planet .spots span:nth-child(6) {
                top: 143px;
                left: 110px;
            }

            .loader-content .planet .spots span:nth-child(7) {
                top: 85px;
                left: 135px;
            }

            .loader-content p {
                font-size: 12px;
                width: 90px;
                bottom: -40px; /* Move text lower */
            }
        }

        @media (max-width: 480px) {
            .loader-content {
                width: 240px;
                height: 240px;
            }

            /* Make moon bigger on mobile */
            .loader-content .planet {
                width: 80%;
                height: 80%;
            }

            /* Adjust spot positions to stay within moon boundaries */
            .loader-content .planet .spots span:nth-child(1) {
                top: 15px;
                right: 35px;
                width: 18px;
                height: 18px;
            }

            .loader-content .planet .spots span:nth-child(2) {
                top: 30px;
                left: 30px;
                width: 10px;
                height: 10px;
            }

            .loader-content .planet .spots span:nth-child(3) {
                top: 60px;
                left: 15px;
                width: 18px;
                height: 18px;
            }

            .loader-content .planet .spots span:nth-child(4) {
                top: 65px;
                left: 70px;
                width: 28px;
                height: 28px;
            }

            .loader-content .planet .spots span:nth-child(5) {
                top: 125px;
                left: 50px;
                width: 10px;
                height: 10px;
            }

            .loader-content .planet .spots span:nth-child(6) {
                top: 128px;
                left: 95px;
                width: 8px;
                height: 8px;
            }

            .loader-content .planet .spots span:nth-child(7) {
                top: 75px;
                left: 120px;
                width: 12px;
                height: 12px;
            }

            .loader-content p {
                font-size: 11px;
                width: 80px;
                bottom: -50px; /* Move text lower on mobile */
            }
        }

        /* ========== Animations ========== */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        /* ========== Button Shine Effect - REMOVED ========== */
        /* Shine effect removed per user request */

        /* ========== Header Section ========== */
        .site-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: #ffffff;
            padding: 10px 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 900;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 70px;
        }

        .site-header .logo {
            height: 50px;
            width: auto;
            margin: 0;
        }

        /* ========== 1. Welcome Section (Hero Section) ========== */
        .hero-section {
            height: 100vh;
            background: linear-gradient(135deg, #ffffff 0%, #EFE9E1 50%, #EFE9E1 100%);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        /* Video background */
        .hero-video-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 0;
            /* Hide native video controls and play button */
            pointer-events: none;
        }

        /* Hide all video controls across browsers */
        .hero-video-background::-webkit-media-controls {
            display: none !important;
        }
        
        .hero-video-background::-webkit-media-controls-enclosure {
            display: none !important;
        }
        
        .hero-video-background::-webkit-media-controls-panel {
            display: none !important;
        }
        
        .hero-video-background::-webkit-media-controls-play-button {
            display: none !important;
        }
        
        .hero-video-background::-webkit-media-controls-start-playback-button {
            display: none !important;
        }
        
        .hero-video-background::-webkit-media-controls-overlay-play-button {
            display: none !important;
        }

        /* Firefox */
        .hero-video-background::-moz-media-controls {
            display: none !important;
        }

        /* Overlay for better text readability */
        .hero-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.4) 0%, rgba(239, 233, 225, 0.4) 50%, rgba(239, 233, 225, 0.4) 100%);
            z-index: 1;
        }

        .hero-section::before {
            content: '';
            position: absolute;
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, rgba(239, 233, 225, 0.3) 0%, transparent 70%);
            border-radius: 50%;
            top: -100px;
            right: -100px;
            animation: float 6s ease-in-out infinite;
            z-index: 1;
        }

        .hero-section::after {
            content: '';
            position: absolute;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(239, 233, 225, 0.2) 0%, transparent 70%);
            border-radius: 50%;
            bottom: -50px;
            left: -50px;
            animation: float 8s ease-in-out infinite;
            animation-delay: 1s;
            z-index: 1;
        }

        .hero-content {
            position: relative;
            z-index: 2;
            text-align: center;
            color: #333;
            padding: 20px;
            animation: fadeInUp 1s ease-out;
        }

        .hero-content h1 {
            font-family: 'Amita', serif;
            font-size: 4rem;
            font-weight: 400;
            text-transform: none;
            margin-bottom: 5px;
            letter-spacing: 2px;
            color: #ffffff;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3), 0 0 20px rgba(255, 255, 255, 0.8);
            animation: fadeInUp 1s ease-out 0.2s both;
        }

        .hero-content h2 {
            font-family: 'Amita', serif;
            font-size: 3rem;
            margin-bottom: 20px;
            font-weight: 400;
            color: #ffffff;
            text-shadow: 1px 1px 4px rgba(255, 255, 255, 0.9), 0 0 10px rgba(255, 255, 255, 0.6);
            animation: fadeInUp 1s ease-out 0.4s both;
        }

        .hero-content p {
            font-size: 1.5rem;
            margin-bottom: 40px;
            color: #555;
            text-shadow: 1px 1px 3px rgba(255, 255, 255, 0.9), 0 0 8px rgba(255, 255, 255, 0.5);
            animation: fadeInUp 1s ease-out 0.6s both;
        }

        .hero-btn {
            position: relative;
            background: #EFE9E1;
            color: #000;
            padding: 18px 40px;
            border: 1px solid #ccc;
            font-size: 1.2rem;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            animation: fadeInUp 1s ease-out 0.8s both;
        }

        .hero-btn:hover {
            background: #EFE9E1;
        }

        .hero-btn:active {
            background: #EFE9E1;
        }

        /* ========== 2. About Section (Pilates Studio Cards) ========== */
        .about-section {
            background-color: #ffffff;
            padding: 80px 20px;
            position: relative;
        }

        .about-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, transparent 0%, #EFE9E1 50%, transparent 100%);
            pointer-events: none;
        }

        .about-section h2 {
            font-size: 3rem;
            color: #333;
            text-align: center;
            margin-bottom: 20px;
            font-weight: 300;
            letter-spacing: 2px;
            animation: fadeInUp 0.8s ease-out;
        }

        .about-section h2::after {
            content: '';
            display: block;
            width: 80px;
            height: 3px;
            background: linear-gradient(90deg, #EFE9E1, #EFE9E1);
            margin: 20px auto 40px;
            border-radius: 2px;
        }

        .pilates-cards-container {
            display: flex;
            gap: 25px;
            overflow-x: auto;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            scroll-behavior: smooth;
            scroll-snap-type: x mandatory;
        }

        .pilates-cards-container::-webkit-scrollbar {
            height: 10px;
        }

        .pilates-cards-container::-webkit-scrollbar-track {
            background: rgba(239, 233, 225, 0.1);
            border-radius: 10px;
        }

        .pilates-cards-container::-webkit-scrollbar-thumb {
            background: linear-gradient(90deg, #EFE9E1, #EFE9E1);
            border-radius: 10px;
            transition: background 0.3s ease;
        }

        .pilates-cards-container::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(90deg, #EFE9E1, #EFE9E1);
        }

        .pilates-card {
            position: relative;
            width: 500px;
            height: 600px;
            flex-shrink: 0;
            border-radius: 25px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            transition: all 0.4s ease;
            cursor: pointer;
            scroll-snap-align: center;
        }

        .pilates-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 50px rgba(239, 233, 225, 0.5);
        }

        .pilates-card-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: all 0.4s ease;
            animation: cardImageDarken 3.5s ease-in-out forwards;
        }

        @keyframes cardImageDarken {
            0% {
                filter: brightness(1);
            }
            100% {
                filter: brightness(0.85);
            }
        }

        .pilates-card.active .pilates-card-image {
            filter: brightness(0.85);
        }

        .pilates-card-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.3);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px;
            opacity: 0;
            transition: opacity 0.4s ease;
            pointer-events: none;
            overflow-y: auto;
            animation: overlayFadeIn 3.5s ease-in-out forwards;
        }

        @keyframes overlayFadeIn {
            0% {
                opacity: 0;
            }
            85.7% {
                opacity: 0;
            }
            100% {
                opacity: 1;
                pointer-events: auto;
            }
        }

        .pilates-card.active .pilates-card-overlay {
            opacity: 1;
            pointer-events: auto;
        }

        .pilates-card-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #333333;
            margin-bottom: 25px;
            text-align: center;
            font-family: 'Amita', serif;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
        }

        .pilates-card-text {
            font-size: 1.2rem;
            color: #333333;
            line-height: 1.9;
            text-align: center;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
        }

        /* Responsive adjustments for mobile - LARGE images */
        @media (max-width: 768px) {
            .pilates-cards-container {
                padding: 15px 10px;
                gap: 20px;
            }

            .pilates-card {
                width: calc(100vw - 40px);
                height: calc(100vh - 200px);
                min-height: 500px;
            }

            .pilates-card-title {
                font-size: 2rem;
            }

            .pilates-card-text {
                font-size: 1.1rem;
                line-height: 1.8;
            }

            .pilates-card-overlay {
                padding: 30px 25px;
            }
        }

        @media (max-width: 480px) {
            .pilates-card {
                width: calc(100vw - 30px);
                height: calc(100vh - 180px);
                min-height: 480px;
            }

            .pilates-card-title {
                font-size: 1.8rem;
            }

            .pilates-card-text {
                font-size: 1.05rem;
                line-height: 1.7;
            }

            .pilates-card-overlay {
                padding: 25px 20px;
            }
        }

        /* ========== 3. Booking Section ========== */
        .booking-section {
            background: #ffffff;
            padding: 80px 20px;
        }

        .booking-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .booking-section h2 {
            font-size: 3rem;
            color: #333;
            text-align: center;
            margin-bottom: 20px;
            font-weight: 300;
            letter-spacing: 2px;
            animation: fadeInUp 0.8s ease-out;
        }

        .booking-section h2::after {
            content: '';
            display: block;
            width: 80px;
            height: 3px;
            background: linear-gradient(90deg, #EFE9E1, #EFE9E1);
            margin: 20px auto;
            border-radius: 2px;
        }

        .plans-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
            justify-content: center;
            margin-bottom: 50px;
            margin-top: 50px;
        }

        .plan-card {
            background: linear-gradient(135deg, #ffffff 0%, #EFE9E1 100%);
            border-radius: 20px;
            padding: 35px 25px;
            width: 220px;
            text-align: center;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.08);
            border: 2px solid rgba(239, 233, 225, 0.3);
            transition: all 0.4s ease;
            opacity: 0;
            animation: fadeInUp 0.6s ease-out forwards;
            position: relative;
            overflow: hidden;
        }

        .plan-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(239, 233, 225, 0.1) 0%, transparent 100%);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .plan-card:hover::before {
            opacity: 1;
        }

        .plan-card:nth-child(1) {
            animation-delay: 0.1s;
        }

        .plan-card:nth-child(2) {
            animation-delay: 0.2s;
        }

        .plan-card:nth-child(3) {
            animation-delay: 0.3s;
        }

        .plan-card:nth-child(4) {
            animation-delay: 0.4s;
        }

        .plan-card:nth-child(5) {
            animation-delay: 0.5s;
        }

        .plan-card:hover {
            transform: translateY(-10px) scale(1.03);
            box-shadow: 0 15px 40px rgba(239, 233, 225, 0.4);
            border-color: #EFE9E1;
        }

        .plan-card h3 {
            color: #000000;
            font-size: 1.6rem;
            margin-bottom: 20px;
            font-weight: 500;
            position: relative;
            z-index: 3;
        }

        .plan-card .price {
            color: #333;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            position: relative;
            z-index: 3;
        }

        .plan-card .savings {
            color: #C51162;
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 15px;
            position: relative;
            z-index: 3;
        }

        .plan-card select {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid rgba(239, 233, 225, 0.5);
            border-radius: 10px;
            background-color: #fff;
            transition: all 0.3s ease;
            position: relative;
        }

        .plan-card select:focus {
            outline: none;
            border-color: #EFE9E1;
            box-shadow: 0 0 0 3px rgba(239, 233, 225, 0.2);
        }

        .plan-btn {
            background: #EFE9E1;
            color: #fff;
            border: 1px solid #ccc;
            padding: 14px 28px;
            font-size: 1rem;
            cursor: pointer;
            width: 100%;
            position: relative;
            z-index: 3;
            margin-bottom: 10px;
        }

        .plan-btn:hover {
            background: #EFE9E1;
        }

        .plan-btn:active {
            background: #EFE9E1;
        }

        .payment-btn {
            background: linear-gradient(135deg, #C51162 0%, #e91e63 100%);
            color: #fff;
            border: none;
            padding: 14px 28px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            position: relative;
            z-index: 3;
            border-radius: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(197, 17, 98, 0.3);
        }

        .payment-btn:hover {
            background: linear-gradient(135deg, #a00f4f 0%, #c2185b 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(197, 17, 98, 0.4);
        }

        .payment-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 10px rgba(197, 17, 98, 0.3);
        }

        /* Card animation layers */
        .plan-card .bg {
            position: absolute;
            top: 5px;
            left: 5px;
            width: calc(100% - 10px);
            height: calc(100% - 10px);
            z-index: 2;
            background: rgba(255, 255, 255, .95);
            backdrop-filter: blur(24px);
            border-radius: 15px;
            overflow: hidden;
            outline: 2px solid white;
        }

        .plan-card .blob {
            position: absolute;
            z-index: 1;
            top: 50%;
            left: 50%;
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background-color: #EFE9E1;
            opacity: 1;
            filter: blur(12px);
            animation: blob-bounce 5s infinite ease;
        }

        @keyframes blob-bounce {
            0% {
                transform: translate(-100%, -100%) translate3d(0, 0, 0);
            }

            25% {
                transform: translate(-100%, -100%) translate3d(100%, 0, 0);
            }

            50% {
                transform: translate(-100%, -100%) translate3d(100%, 100%, 0);
            }

            75% {
                transform: translate(-100%, -100%) translate3d(0, 100%, 0);
            }

            100% {
                transform: translate(-100%, -100%) translate3d(0, 0, 0);
            }
        }

        /* Contenedor del calendario - Responsive y centrado con máximo ampliado */
        #calendar-container {
            display: none;
            max-width: 1400px; /* Ancho máximo aumentado para mejor visibilidad */
            margin: 50px auto 0; /* Centrado automático */
            padding: 30px;
            background: linear-gradient(135deg, #ffffff 0%, #EFE9E1 100%);
            border-radius: 25px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            border: 2px solid rgba(239, 233, 225, 0.3);
            animation: fadeInUp 0.8s ease-out;
            width: 95%; /* Usar 95% del ancho disponible */
        }

        /* Div con id="calendar" donde se renderiza FullCalendar */
        #calendar {
            color: #333;
        }

        /* ========== Enhanced Calendar Styling ========== */
        .fc {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* Calendar header */
        .fc .fc-toolbar-title {
            font-size: 2.2rem; /* Aumentado para mejor visibilidad */
            color: #333;
            font-weight: 600;
        }

        .fc .fc-button {
            background: #EFE9E1;
            border: 1px solid #ccc;
            color: #fff;
            padding: 10px 20px;
        }

        .fc .fc-button:hover {
            background: #EFE9E1;
        }

        .fc .fc-button-active {
            background: #EFE9E1 !important;
        }

        /* Time slots styling - Aumentado para mejor visibilidad */
        .fc .fc-timegrid-slot {
            height: 4.5rem; /* Aumentado de 3.5rem a 4.5rem */
            border-color: rgba(239, 233, 225, 0.2);
            transition: background-color 0.3s ease;
        }

        .fc .fc-timegrid-slot-label {
            font-size: 1.1rem; /* Aumentado de 0.95rem a 1.1rem */
            font-weight: 600; /* Aumentado de 500 a 600 */
            color: #333; /* Cambiado de #666 a #333 para mejor contraste */
            padding: 8px; /* Añadido padding */
        }

        /* Day headers - Mejorado para mejor visibilidad */
        .fc .fc-col-header-cell {
            background: linear-gradient(135deg, #EFE9E1 0%, #ffffff 100%);
            padding: 20px 8px; /* Aumentado padding */
            font-weight: 700; /* Aumentado de 600 a 700 */
            font-size: 1.2rem; /* Añadido tamaño de fuente más grande */
            color: #333;
            border-color: rgba(239, 233, 225, 0.3);
        }

        .fc .fc-day-today {
            background-color: rgba(239, 233, 225, 0.15) !important;
        }

        /* Available time slots highlighting */
        .fc .fc-timegrid-slot[data-time*="06:00"],
        .fc .fc-timegrid-slot[data-time*="07:00"],
        .fc .fc-timegrid-slot[data-time*="08:00"],
        .fc .fc-timegrid-slot[data-time*="09:00"],
        .fc .fc-timegrid-slot[data-time*="10:00"],
        .fc .fc-timegrid-slot[data-time*="17:00"],
        .fc .fc-timegrid-slot[data-time*="18:00"],
        .fc .fc-timegrid-slot[data-time*="19:00"] {
            background-color: rgba(239, 233, 225, 0.08);
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .fc .fc-timegrid-slot[data-time*="06:00"]:hover,
        .fc .fc-timegrid-slot[data-time*="07:00"]:hover,
        .fc .fc-timegrid-slot[data-time*="08:00"]:hover,
        .fc .fc-timegrid-slot[data-time*="09:00"]:hover,
        .fc .fc-timegrid-slot[data-time*="10:00"]:hover,
        .fc .fc-timegrid-slot[data-time*="17:00"]:hover,
        .fc .fc-timegrid-slot[data-time*="18:00"]:hover,
        .fc .fc-timegrid-slot[data-time*="19:00"]:hover {
            background-color: rgba(239, 233, 225, 0.2);
        }

        /* Events (booked classes) - Mejorado para mejor visibilidad */
        .fc-event {
            border-radius: 10px;
            padding: 8px; /* Aumentado de 4px a 8px */
            font-weight: 600; /* Aumentado de 500 a 600 */
            font-size: 1.05rem; /* Añadido tamaño de fuente más grande */
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .fc-event:hover {
            opacity: 0.85;
            transform: scale(1.02);
        }

        /* Grid lines */
        .fc .fc-timegrid-col {
            border-color: rgba(239, 233, 225, 0.2);
        }

        .fc .fc-timegrid-axis {
            background-color: #fefefe;
            width: 70px; /* Ancho fijo para mejor visibilidad de las horas */
        }

        /* Hide non-business hour slots for public calendar */
        .fc .fc-timegrid-slot[data-time*="11:00"],
        .fc .fc-timegrid-slot[data-time*="12:00"],
        .fc .fc-timegrid-slot[data-time*="13:00"],
        .fc .fc-timegrid-slot[data-time*="14:00"],
        .fc .fc-timegrid-slot[data-time*="15:00"],
        .fc .fc-timegrid-slot[data-time*="16:00"] {
            display: none;
        }

        /* Hide non-business hour slots for admin calendar (hours 11:00-16:00) */
        #admin-calendar .fc-timegrid-slot[data-time*="11:00"],
        #admin-calendar .fc-timegrid-slot[data-time*="12:00"],
        #admin-calendar .fc-timegrid-slot[data-time*="13:00"],
        #admin-calendar .fc-timegrid-slot[data-time*="14:00"],
        #admin-calendar .fc-timegrid-slot[data-time*="15:00"],
        #admin-calendar .fc-timegrid-slot[data-time*="16:00"] {
            display: none;
        }

        /* Calendar info banner */
        .calendar-info {
            background: linear-gradient(135deg, #EFE9E1 0%, #ffffff 100%);
            padding: 25px 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
            border: 2px solid rgba(239, 233, 225, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .calendar-info h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.4rem;
            font-weight: 600;
        }

        .calendar-info p {
            color: #666;
            margin: 8px 0;
            font-size: 1rem;
        }

        .calendar-legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 15px;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
        }

        .legend-item:hover {
            transform: translateY(-2px);
        }

        .legend-color {
            width: 24px;
            height: 24px;
            border-radius: 6px;
        }

        .legend-available {
            background-color: rgba(239, 233, 225, 0.5);
            border: 2px solid #EFE9E1;
        }

        .legend-booked {
            background: linear-gradient(135deg, #EFE9E1 0%, #EFE9E1 100%);
            border: 2px solid #EFE9E1;
        }

        /* ========== 3.5. My Classes Section ========== */
        .my-classes-section {
            display: none; /* Hidden by default, shown when user is logged in */
            background: linear-gradient(135deg, #EFE9E1 0%, #ffffff 100%);
            padding: 80px 20px;
            position: relative;
        }

        .my-classes-section h2 {
            font-size: 3rem;
            color: #333;
            text-align: center;
            margin-bottom: 20px;
            font-weight: 300;
            letter-spacing: 2px;
            animation: fadeInUp 0.8s ease-out;
        }

        .my-classes-section h2::after {
            content: '';
            display: block;
            width: 80px;
            height: 3px;
            background: linear-gradient(90deg, #EFE9E1, #EFE9E1);
            margin: 20px auto 40px;
            border-radius: 2px;
        }

        .my-classes-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .my-classes-empty {
            text-align: center;
            padding: 60px 20px;
            color: #666;
            font-size: 1.2rem;
        }

        .my-classes-empty-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .my-classes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .class-card {
            background: linear-gradient(135deg, #ffffff 0%, #EFE9E1 100%);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.08);
            border: 2px solid rgba(239, 233, 225, 0.3);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
            animation: fadeInUp 0.6s ease-out forwards;
        }

        .class-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, #EFE9E1, #EFE9E1);
        }

        .class-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(239, 233, 225, 0.4);
            border-color: #EFE9E1;
        }

        .class-card-date {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            color: #333;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .class-card-date-icon {
            font-size: 1.8rem;
            color: #EFE9E1;
        }

        .class-card-time {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            color: #666;
            font-size: 1.1rem;
        }

        .class-card-time-icon {
            font-size: 1.5rem;
            color: #EFE9E1;
        }

        .class-card-info {
            color: #777;
            font-size: 0.95rem;
            line-height: 1.6;
            padding: 15px;
            background: rgba(239, 233, 225, 0.1);
            border-radius: 10px;
            margin-top: 15px;
        }

        .class-card-status {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-top: 15px;
        }

        .class-card-status.upcoming {
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            color: #2e7d32;
        }

        .class-card-status.past {
            background: linear-gradient(135deg, #f5f5f5, #e0e0e0);
            color: #757575;
        }

        /* Loading spinner for my classes */
        .my-classes-loading {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .my-classes-loading-spinner {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 5px solid rgba(239, 233, 225, 0.3);
            border-top-color: #EFE9E1;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .my-classes-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .class-card {
                padding: 25px;
            }

            .class-card-date {
                font-size: 1.1rem;
            }

            .class-card-time {
                font-size: 1rem;
            }
        }

        /* ========== 4. Image Scroll Section ========== */
        .image-scroll-section {
            background: linear-gradient(180deg, #ffffff 0%, #EFE9E1 50%, #ffffff 100%);
            padding: 80px 20px;
        }

        .image-scroll-section h2 {
            font-size: 3rem;
            color: #333;
            text-align: center;
            margin-bottom: 20px;
            font-weight: 300;
            letter-spacing: 2px;
            animation: fadeInUp 0.8s ease-out;
        }

        .image-scroll-section h2::after {
            content: '';
            display: block;
            width: 80px;
            height: 3px;
            background: linear-gradient(90deg, #EFE9E1, #EFE9E1);
            margin: 20px auto 40px;
            border-radius: 2px;
        }

        .image-scroll-container {
            display: flex;
            gap: 25px;
            overflow-x: auto;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            scroll-behavior: smooth;
        }

        .image-scroll-container::-webkit-scrollbar {
            height: 8px;
        }

        .image-scroll-container::-webkit-scrollbar-track {
            background: rgba(239, 233, 225, 0.1);
            border-radius: 10px;
        }

        .image-scroll-container::-webkit-scrollbar-thumb {
            background: linear-gradient(90deg, #EFE9E1, #EFE9E1);
            border-radius: 10px;
            transition: background 0.3s ease;
        }

        .image-scroll-container::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(90deg, #EFE9E1, #EFE9E1);
        }

        .image-wrapper {
            position: relative;
            width: 320px;
            height: 320px;
            flex-shrink: 0;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.4s ease;
            cursor: pointer;
        }

        .image-wrapper:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 15px 40px rgba(239, 233, 225, 0.4);
        }

        .scroll-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: all 0.4s ease;
        }

        /* Heart overlay - outline by default (Instagram-style smaller size) */
        .heart-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 28px;
            color: transparent;
            -webkit-text-stroke: 1.5px white;
            text-stroke: 1.5px white;
            pointer-events: none;
            transition: all 0.3s ease;
            text-shadow: 0 1px 4px rgba(0, 0, 0, 0.3);
            opacity: 0.7;
        }

        .image-wrapper:hover .heart-overlay {
            opacity: 1;
        }

        /* Filled heart when liked */
        .heart-overlay.liked {
            color: #ff0000;
            -webkit-text-stroke: 0;
            text-stroke: 0;
            animation: heartBeat 0.5s ease;
        }

        /* Heart animation */
        @keyframes heartBeat {
            0% {
                transform: translate(-50%, -50%) scale(0.8);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.3);
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }

        /* Like animation effect (Instagram-style burst) */
        .like-burst {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 45px;
            color: #ff0000;
            pointer-events: none;
            animation: likeBurst 0.8s ease forwards;
            opacity: 0;
        }

        @keyframes likeBurst {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 1;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2);
                opacity: 0.8;
            }
            100% {
                transform: translate(-50%, -50%) scale(1.5);
                opacity: 0;
            }
        }

        /* ========== Custom Alert/Notification System ========== */
        .custom-alert-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        .custom-alert-card {
            background: linear-gradient(135deg, #ffffff 0%, #EFE9E1 100%);
            border-radius: 25px;
            padding: 40px 35px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(239, 233, 225, 0.4);
            border: 3px solid #EFE9E1;
            animation: slideInUp 0.4s ease;
            position: relative;
            text-align: center;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .custom-alert-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            display: block;
            animation: pulse 1s ease infinite;
        }

        .custom-alert-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            font-family: 'Amita', serif;
        }

        .custom-alert-message {
            font-size: 1.1rem;
            color: #666;
            line-height: 1.8;
            margin-bottom: 30px;
            white-space: pre-line;
        }

        .custom-alert-button {
            background: linear-gradient(135deg, #EFE9E1 0%, #EFE9E1 100%);
            color: #fff;
            padding: 15px 40px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(239, 233, 225, 0.4);
        }

        .custom-alert-button:hover {
            background: linear-gradient(135deg, #EFE9E1 0%, #EFE9E1 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(239, 233, 225, 0.6);
        }

        .custom-alert-button:active {
            transform: translateY(0);
        }

        /* Alert type variants */
        .custom-alert-success .custom-alert-icon {
            color: #4CAF50;
        }

        .custom-alert-error .custom-alert-icon {
            color: #f44336;
        }

        .custom-alert-warning .custom-alert-icon {
            color: #ff9800;
        }

        .custom-alert-info .custom-alert-icon {
            color: #2196F3;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .custom-alert-card {
                padding: 30px 25px;
                max-width: 90%;
            }

            .custom-alert-icon {
                font-size: 3rem;
            }

            .custom-alert-title {
                font-size: 1.5rem;
            }

            .custom-alert-message {
                font-size: 1rem;
            }

            .custom-alert-button {
                padding: 12px 30px;
                font-size: 1rem;
            }
        }

        /* ========== 5. Contact Section ========== */
        .contact-section {
            background: linear-gradient(135deg, #EFE9E1 0%, #ffffff 100%);
            padding: 80px 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        /* ========== Reglamento Link Styles ========== */
        .reglamento-link {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, #ffffff 0%, #EFE9E1 100%);
        }

        .reglamento-link a {
            font-size: 1.2rem;
            font-weight: bold;
            text-decoration: underline;
            color: #000;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
        }

        .reglamento-link a:hover {
            color: #000;
            transform: scale(1.05);
        }

        /* Modal for Reglamento */
        .reglamento-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 3000;
            justify-content: center;
            align-items: center;
            overflow-y: auto;
            padding: 20px;
        }

        .reglamento-content {
            background: linear-gradient(135deg, #ffffff 0%, #EFE9E1 100%);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            border: 2px solid rgba(239, 233, 225, 0.3);
            position: relative;
        }

        .reglamento-content h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 2rem;
            font-weight: 600;
            text-align: center;
        }

        .reglamento-content h3 {
            color: #EFE9E1;
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 1.4rem;
            font-weight: 600;
        }

        .reglamento-content p {
            color: #666;
            line-height: 1.8;
            margin-bottom: 15px;
            text-align: left;
        }

        .reglamento-content strong {
            color: #333;
            font-weight: 600;
        }

        .reglamento-close {
            background: linear-gradient(135deg, #EFE9E1 0%, #EFE9E1 100%);
            color: #fff;
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.4s ease;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(239, 233, 225, 0.3);
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .reglamento-close:hover {
            background: linear-gradient(135deg, #EFE9E1 0%, #EFE9E1 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(239, 233, 225, 0.5);
        }

        @media (max-width: 768px) {
            .reglamento-content {
                padding: 30px 20px;
                max-height: 85vh;
            }

            .reglamento-content h2 {
                font-size: 1.6rem;
            }

            .reglamento-content h3 {
                font-size: 1.2rem;
            }

            .reglamento-link a {
                font-size: 1.1rem;
            }
        }

        .contact-section::before {
            content: '';
            position: absolute;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(239, 233, 225, 0.2) 0%, transparent 70%);
            border-radius: 50%;
            top: -100px;
            right: -100px;
            animation: float 8s ease-in-out infinite;
        }

        .contact-section h2 {
            font-size: 3rem;
            color: #333;
            margin-bottom: 30px;
            font-weight: 300;
            letter-spacing: 2px;
            animation: fadeInUp 0.8s ease-out;
            position: relative;
        }

        .contact-section h2::after {
            content: '';
            display: block;
            width: 80px;
            height: 3px;
            background: linear-gradient(90deg, #EFE9E1, #EFE9E1);
            margin: 20px auto;
            border-radius: 2px;
        }

        .contact-section p {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 15px;
            animation: fadeInUp 0.8s ease-out;
            position: relative;
        }

        .contact-btn {
            background: #EFE9E1;
            color: #fff;
            padding: 18px 40px;
            border: 1px solid #ccc;
            font-size: 1.2rem;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin: 30px 0;
            animation: fadeInUp 0.8s ease-out;
            position: relative;
        }

        .contact-btn:hover {
            background: #EFE9E1;
        }

        .contact-btn:active {
            background: #EFE9E1;
        }

        .hours {
            font-size: 1.1rem;
            color: #666;
            margin-top: 20px;
            animation: fadeInUp 0.8s ease-out;
            position: relative;
        }

        /* ========== Admin Calendar Styles ========== */
        #admin-calendar-view {
            margin-top: 40px;
            background: linear-gradient(135deg, #ffffff 0%, #EFE9E1 100%);
            padding: 50px;
            border-radius: 20px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
            border: 2px solid rgba(239, 233, 225, 0.3);
            transition: all 0.4s ease;
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
        }

        #admin-calendar-view:hover {
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }

        /* Admin calendar controls */
        .admin-calendar-controls {
            display: flex;
            gap: 20px;
            margin-bottom: 40px;
            flex-wrap: wrap;
            align-items: center;
            padding: 25px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .admin-calendar-controls input,
        .admin-calendar-controls select {
            padding: 14px 20px;
            border: 2px solid rgba(239, 233, 225, 0.3);
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
            color: #333;
        }

        .admin-calendar-controls input:focus,
        .admin-calendar-controls select:focus {
            outline: none;
            border-color: #EFE9E1;
            box-shadow: 0 0 0 3px rgba(239, 233, 225, 0.2);
        }

        .admin-calendar-controls button {
            padding: 14px 28px;
            background: #EFE9E1;
            color: white;
            border: 1px solid #ccc;
            font-size: 1rem;
            cursor: pointer;
        }

        .admin-calendar-controls button:hover {
            background: #EFE9E1;
        }

        .admin-calendar-controls button:active {
            background: #EFE9E1;
        }

        /* Stats summary */
        .admin-stats-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: linear-gradient(135deg, #ffffff 0%, #EFE9E1 100%);
            padding: 25px 20px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid rgba(239, 233, 225, 0.3);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(239, 233, 225, 0.3);
        }

        .stat-card .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .stat-card .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #EFE9E1;
            margin-bottom: 5px;
        }

        .stat-card .stat-label {
            font-size: 0.95rem;
            color: #666;
            font-weight: 500;
        }

        #admin-calendar {
            min-height: 1000px; /* Aumentado de 900px a 1000px */
            border-radius: 15px;
            overflow: hidden;
            width: 100%;
        }

        /* Admin calendar event styling - Mejorado para mejor visibilidad */
        #admin-calendar .fc-event {
            font-size: 1.15rem; /* Aumentado de 1.05rem a 1.15rem */
            padding: 12px 14px; /* Aumentado padding */
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            font-weight: 600; /* Aumentado de 500 a 600 */
        }

        #admin-calendar .fc-event:hover {
            transform: scale(1.03);
            box-shadow: 0 4px 15px rgba(239, 233, 225, 0.4);
        }

        #admin-calendar .fc-event-title {
            font-weight: 700; /* Aumentado de 600 a 700 */
            font-size: 1.15rem; /* Aumentado de 1.05rem a 1.15rem */
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* Event detail modal */
        .event-detail-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 3000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .event-detail-content {
            background: linear-gradient(135deg, #ffffff 0%, #EFE9E1 100%);
            padding: 35px;
            border-radius: 20px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 100%;
            border: 2px solid rgba(239, 233, 225, 0.4);
            position: relative;
            animation: modalFadeIn 0.3s ease-out;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .event-detail-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(239, 233, 225, 0.3);
        }

        .event-detail-header h3 {
            color: #333;
            font-size: 1.8rem;
            font-weight: 600;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .event-detail-close {
            background: transparent;
            border: none;
            font-size: 2rem;
            color: #999;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .event-detail-close:hover {
            background: rgba(239, 233, 225, 0.2);
            color: #EFE9E1;
            transform: rotate(90deg);
        }

        .event-detail-body {
            display: flex;
            flex-direction: column;
            gap: 18px;
        }

        .event-detail-row {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 10px;
            border-left: 4px solid #EFE9E1;
        }

        .event-detail-icon {
            font-size: 1.5rem;
            min-width: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .event-detail-info {
            flex: 1;
        }

        .event-detail-label {
            font-size: 0.85rem;
            color: #999;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .event-detail-value {
            font-size: 1.1rem;
            color: #333;
            font-weight: 600;
        }

        .event-detail-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .event-detail-actions button {
            flex: 1;
            padding: 12px;
            border: 1px solid #ccc;
            font-size: 1rem;
            cursor: pointer;
        }

        .event-detail-actions .btn-primary {
            background: #EFE9E1;
            color: white;
        }

        .event-detail-actions .btn-primary:hover {
            background: #EFE9E1;
        }

        .event-detail-actions .btn-secondary {
            background: #e0e0e0;
            color: #666;
        }

        .event-detail-actions .btn-secondary:hover {
            background: #d0d0d0;
        }

        /* Admin calendar time grid */
        #admin-calendar .fc-timegrid-slot {
            height: 4.5rem;
            transition: background-color 0.3s ease;
        }

        #admin-calendar .fc-timegrid-slot:hover {
            background-color: rgba(239, 233, 225, 0.1);
        }

        #admin-calendar .fc-timegrid-slot-label {
            font-size: 1.05rem;
            color: #666;
            font-weight: 500;
            padding: 8px;
        }

        /* Enhanced admin calendar toolbar */
        #admin-calendar .fc-toolbar-title {
            font-size: 2.2rem;
            color: #333;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        #admin-calendar .fc-button {
            background: #EFE9E1;
            border: 1px solid #ccc;
            color: #fff;
            padding: 14px 26px;
            font-size: 1.05rem;
        }

        #admin-calendar .fc-button:hover {
            background: #EFE9E1;
        }

        #admin-calendar .fc-button-active {
            background: #EFE9E1 !important;
        }

        /* Admin calendar day headers */
        #admin-calendar .fc-col-header-cell {
            background: linear-gradient(135deg, #EFE9E1 0%, #ffffff 100%);
            padding: 22px 10px;
            font-weight: 600;
            font-size: 1.15rem;
            color: #333;
            border-color: rgba(239, 233, 225, 0.3);
        }

        #admin-calendar .fc-day-today {
            background-color: rgba(239, 233, 225, 0.15) !important;
        }

        /* Admin calendar grid lines */
        #admin-calendar .fc-timegrid-col {
            border-color: rgba(239, 233, 225, 0.2);
        }

        #admin-calendar .fc-timegrid-axis {
            background-color: #fefefe;
        }

        /* ========== Responsive Design ========== */
        @media (max-width: 768px) {
            .hero-content h1 {
                font-size: 2.5rem;
                letter-spacing: 4px;
            }

            .hero-content h2 {
                font-size: 2rem;
            }

            .hero-content p {
                font-size: 1.2rem;
            }

            .hero-btn {
                padding: 15px 30px;
                font-size: 1rem;
            }

            /* Video background on mobile - ensure it covers properly */
            .hero-video-background {
                object-fit: cover;
                object-position: center center;
            }

            /* Stronger overlay on mobile for better text visibility */
            .hero-overlay {
                background: linear-gradient(135deg, rgba(255, 255, 255, 0.5) 0%, rgba(239, 233, 225, 0.5) 50%, rgba(239, 233, 225, 0.5) 100%);
            }

            .about-section {
                padding: 60px 20px;
            }

            .about-item {
                flex-direction: column;
                gap: 25px;
                margin-bottom: 40px;
            }

            .about-item.reverse {
                flex-direction: column;
            }

            .about-image {
                min-width: 100%;
            }

            .about-image img {
                height: 300px;
            }

            .about-text {
                padding: 30px 25px;
            }

            .booking-section,
            .image-scroll-section,
            .contact-section {
                padding: 60px 20px;
            }

            .plans-grid {
                flex-direction: column;
                align-items: center;
                gap: 20px;
            }

            .plan-card {
                width: 100%;
                max-width: 320px;
            }

            .booking-section h2,
            .image-scroll-section h2,
            .contact-section h2 {
                font-size: 2.2rem;
            }

            .contact-section p {
                font-size: 1.1rem;
            }

            .contact-btn {
                padding: 15px 30px;
                font-size: 1.1rem;
            }

            #calendar-container {
                padding: 15px 10px;
                margin: 30px 10px 0;
                border-radius: 15px;
            }
            
            /* Admin panel container en móvil - ajustar para permitir que el calendario salga */
            #admin-panel-container {
                padding: 30px 20px !important;
                margin: 0 10px !important;
                border-radius: 20px !important;
                overflow: visible !important; /* Permitir que el calendario salga del contenedor */
            }

            .calendar-info {
                padding: 15px;
                margin-bottom: 20px;
            }

            .calendar-info h3 {
                font-size: 1.2rem;
                margin-bottom: 10px;
            }

            .calendar-info p {
                font-size: 0.9rem;
                margin: 5px 0;
            }

            .calendar-legend {
                gap: 15px;
                margin-top: 15px;
            }

            .legend-item {
                padding: 6px 12px;
                font-size: 0.85rem;
            }

            .legend-color {
                width: 20px;
                height: 20px;
            }

            /* Mobile Calendar Styles */
            .fc .fc-toolbar {
                display: flex;
                flex-direction: column;
                gap: 10px;
                padding: 10px 5px;
            }

            .fc .fc-toolbar-chunk {
                display: flex;
                justify-content: center;
                align-items: center;
                flex-wrap: wrap;
                gap: 8px;
            }

            .fc .fc-toolbar-title {
                font-size: 1.1rem;
                text-align: center;
                width: 100%;
                margin: 5px 0;
            }

            .fc .fc-button {
                padding: 8px 12px;
                font-size: 0.85rem;
                border-radius: 8px;
            }

            .fc .fc-button-group {
                display: flex;
                gap: 5px;
            }

            /* Mobile time grid adjustments - Mejorado para mejor visibilidad */
            .fc .fc-timegrid-slot {
                height: 3.5rem; /* Aumentado de 2.8rem a 3.5rem */
                font-size: 1rem; /* Aumentado de 0.85rem a 1rem */
            }

            .fc .fc-timegrid-slot-label {
                font-size: 1rem; /* Aumentado de 0.8rem a 1rem */
                padding: 5px; /* Aumentado padding */
                font-weight: 600; /* Añadido peso */
            }

            .fc .fc-col-header-cell {
                padding: 15px 5px; /* Aumentado padding */
                font-size: 1.1rem; /* Aumentado de 0.85rem a 1.1rem */
                font-weight: 700; /* Añadido peso */
            }

            .fc .fc-timegrid-axis {
                width: 60px !important; /* Aumentado de 45px a 60px para móvil */
            }

            .fc .fc-event {
                font-size: 0.95rem; /* Aumentado de 0.75rem a 0.95rem */
                padding: 6px; /* Aumentado de 2px a 6px */
                font-weight: 600; /* Añadido peso */
            }

            /* Make calendar scrollable horizontally on mobile */
            #calendar {
                overflow-x: auto;
                overflow-y: visible;
                min-width: 100%;
            }

            /* Improve touch targets for mobile */
            .fc .fc-timegrid-slot {
                min-height: 40px;
            }

            .image-wrapper {
                width: 280px;
                height: 280px;
            }

            .heart-overlay {
                font-size: 24px;
                -webkit-text-stroke: 1.5px white;
            }

            .like-burst {
                font-size: 40px;
            }

            /* Admin calendar mobile adjustments - SEPARADO DE LA TARJETA para mejor visibilidad */
            
            /* Romper el calendario fuera del contenedor en móvil */
            #admin-calendar-view {
                /* Salir del contenedor padre y ocupar todo el ancho */
                position: relative;
                left: 50%;
                right: 50%;
                margin-left: -50vw;
                margin-right: -50vw;
                width: 100vw;
                max-width: 100vw;
                padding: 20px 10px;
                margin-top: 30px;
                margin-bottom: 30px;
                background: linear-gradient(135deg, #ffffff 0%, #EFE9E1 100%);
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            }

            #admin-calendar {
                min-height: 850px; /* Aumentado de 750px a 850px para mejor visibilidad en móvil */
                width: 100%;
            }

            #admin-calendar .fc-timegrid-slot {
                height: 4.5rem; /* Aumentado de 4rem a 4.5rem */
            }

            #admin-calendar .fc-timegrid-slot-label {
                font-size: 1.1rem; /* Aumentado de 1rem a 1.1rem */
                padding: 6px;
                font-weight: 700; /* Aumentado de 600 a 700 */
            }

            #admin-calendar .fc-event {
                font-size: 1.05rem; /* Aumentado de 1rem a 1.05rem */
                padding: 10px 12px; /* Aumentado padding */
                font-weight: 700; /* Aumentado de 600 a 700 */
            }

            #admin-calendar .fc-toolbar-title {
                font-size: 1.8rem; /* Aumentado de 1.7rem a 1.8rem */
                font-weight: 700;
            }

            #admin-calendar .fc-button {
                padding: 16px 24px; /* Aumentado padding */
                font-size: 1.05rem; /* Aumentado de 1rem a 1.05rem */
                font-weight: 600;
            }

            #admin-calendar .fc-col-header-cell {
                font-size: 1.2rem; /* Aumentado de 1.15rem a 1.2rem */
                padding: 20px 8px; /* Aumentado padding */
                font-weight: 700; /* Mantener peso */
            }

            /* Mobile controls - Mantener dentro de la tarjeta principal */
            .admin-calendar-controls {
                flex-direction: column;
                gap: 12px;
                padding: 20px 15px;
            }
            
            .admin-stats-summary {
                gap: 15px;
                margin-bottom: 30px;
                grid-template-columns: repeat(2, 1fr); /* 2 columnas en móvil para mejor uso del espacio */
            }

            .admin-calendar-controls input,
            .admin-calendar-controls select,
            .admin-calendar-controls button {
                width: 100%;
                font-size: 1rem;
            }

            .stat-card {
                padding: 18px 15px; /* Aumentado padding */
            }

            .stat-card .stat-icon {
                font-size: 2.2rem; /* Aumentado de 2rem */
            }

            .stat-card .stat-value {
                font-size: 1.7rem; /* Aumentado de 1.5rem */
            }
            
            .stat-card .stat-label {
                font-size: 0.9rem;
            }

            .event-detail-content {
                padding: 25px 20px;
                max-width: 95%;
            }

            .event-detail-header h3 {
                font-size: 1.4rem;
            }

            .event-detail-row {
                padding: 10px;
            }

            .event-detail-icon {
                font-size: 1.2rem;
            }

            .event-detail-value {
                font-size: 1rem;
            }

            /* Mobile responsive styles for reservation modals */
            #time-selection-modal > div {
                padding: 25px 20px !important;
                width: 95% !important;
                border-radius: 15px !important;
            }

            #time-selection-modal h2 {
                font-size: 1.3rem !important;
                margin-bottom: 8px !important;
            }

            #time-selection-modal p {
                font-size: 0.9rem !important;
                margin-bottom: 15px !important;
            }

            #time-slots-container {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 8px !important;
                max-height: 300px !important;
                padding: 8px !important;
            }

            #time-selection-modal button {
                padding: 10px 15px !important;
                font-size: 0.9rem !important;
            }

            #reservation-modal > div {
                padding: 25px 20px !important;
                width: 95% !important;
                border-radius: 15px !important;
                max-height: 90vh !important;
                overflow-y: auto !important;
            }

            #reservation-modal h2 {
                font-size: 1.3rem !important;
                margin-bottom: 15px !important;
            }

            #reservation-modal label {
                font-size: 0.85rem !important;
                margin-bottom: 6px !important;
            }

            #reservation-modal input {
                padding: 12px !important;
                font-size: 0.9rem !important;
            }

            #reservation-modal .reservation-info-box {
                padding: 15px !important;
                margin-bottom: 20px !important;
            }

            #reservation-date-display,
            #reservation-time-display {
                font-size: 0.95rem !important;
            }

            #reservation-progress {
                font-size: 1.1rem !important;
            }

            #reservation-modal button {
                padding: 12px !important;
                font-size: 0.95rem !important;
            }

            #reservation-cancel,
            #reservation-confirm {
                padding: 14px !important;
                font-size: 0.9rem !important;
            }
        }

        @media (max-width: 480px) {
            .hero-content h1 {
                font-size: 2rem;
                letter-spacing: 3px;
            }

            .hero-content h2 {
                font-size: 1.5rem;
            }

            .hero-content p {
                font-size: 1rem;
            }

            .booking-section h2,
            .image-scroll-section h2,
            .contact-section h2 {
                font-size: 1.8rem;
            }

            .plan-card {
                max-width: 280px;
            }

            #calendar-container {
                padding: 10px 5px;
                margin: 20px 5px 0;
            }

            .calendar-info {
                padding: 12px;
            }

            .calendar-info h3 {
                font-size: 1rem;
            }

            .calendar-info p {
                font-size: 0.85rem;
            }

            .calendar-legend {
                gap: 10px;
                flex-direction: column;
            }

            .legend-item {
                width: 100%;
                justify-content: center;
            }

            /* Extra small mobile adjustments */
            .fc .fc-toolbar-title {
                font-size: 0.95rem;
            }

            .fc .fc-button {
                padding: 6px 10px;
                font-size: 0.75rem;
            }

            .fc .fc-timegrid-slot {
                height: 2.5rem;
            }

            .fc .fc-timegrid-slot-label {
                font-size: 0.7rem;
            }

            .fc .fc-col-header-cell {
                font-size: 0.75rem;
                padding: 8px 2px;
            }

            .fc .fc-timegrid-axis {
                width: 40px !important;
            }

            .image-wrapper {
                width: 260px;
                height: 260px;
            }

            .heart-overlay {
                font-size: 22px;
                -webkit-text-stroke: 1px white;
            }

            .like-burst {
                font-size: 35px;
            }

            /* Extra small mobile adjustments for reservation modals */
            #time-selection-modal > div {
                padding: 20px 15px !important;
            }

            #time-selection-modal h2 {
                font-size: 1.15rem !important;
            }

            #time-selection-modal p {
                font-size: 0.85rem !important;
            }

            #time-slots-container {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 6px !important;
                max-height: 250px !important;
            }

            #reservation-modal > div {
                padding: 20px 15px !important;
                max-height: 85vh !important;
            }

            #reservation-modal h2 {
                font-size: 1.15rem !important;
            }

            #reservation-modal input {
                padding: 10px !important;
                font-size: 0.85rem !important;
            }

            #reservation-date-display,
            #reservation-time-display {
                font-size: 0.9rem !important;
            }

            #reservation-progress {
                font-size: 1rem !important;
            }

            #reservation-cancel,
            #reservation-confirm {
                padding: 12px !important;
                font-size: 0.85rem !important;
            }
        }
    </style>
</head>
<body>
    <!-- ========== Page Loader ========== -->
    <div id="page-loader">
        <div class="loader-content">
            <div class="planet">
                <div class="spots">
                    <span></span>
                    <span></span>
                    <span></span>
                    <span></span>
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
            <p>Aura Studio</p>
        </div>
    </div>

    <!-- ========== Site Header ========== -->
    <header class="site-header">
        <img src="auralogo2.png" alt="AURA" class="logo">
    </header>

    <!-- ========== Hamburger Menu ========== -->
    <!-- Menú hamburguesa en la esquina superior derecha -->
    <div id="hamburger-container" style="position: fixed; top: 0; right: 20px; z-index: 1000; height: 70px; display: flex; align-items: center;">
        <!-- Botón hamburguesa (tres líneas) -->
        <button type="button" id="hamburger-btn" aria-label="Abrir menú de opciones" aria-expanded="false" aria-controls="menu-dropdown" style="background: transparent; border: none; padding: 10px; cursor: pointer; display: flex; flex-direction: column; justify-content: center;">
            <div style="width: 30px; height: 3px; background-color: #EFE9E1; margin: 6px 0; border-radius: 2px;"></div>
            <div style="width: 30px; height: 3px; background-color: #EFE9E1; margin: 6px 0; border-radius: 2px;"></div>
            <div style="width: 30px; height: 3px; background-color: #EFE9E1; margin: 6px 0; border-radius: 2px;"></div>
        </button>
        
        <!-- Menú desplegable -->
        <div id="menu-dropdown" role="menu" aria-hidden="true" style="display: none; position: absolute; top: 60px; right: 0; background: linear-gradient(135deg, #ffffff 0%, #EFE9E1 100%); border-radius: 15px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15); border: 2px solid rgba(239, 233, 225, 0.3); min-width: 200px; overflow: hidden;">
            <button type="button" id="menu-register" role="menuitem" aria-label="Registrarse" style="display: block; width: 100%; padding: 15px 20px; background: #fff; border: none; text-align: left; cursor: pointer; color: #333; font-size: 1rem; border-bottom: 1px solid #ccc;">
                📝 Registrarse
            </button>
            <button type="button" id="menu-my-classes" role="menuitem" aria-label="Mis Clases" style="display: block; width: 100%; padding: 15px 20px; background: #fff; border: none; text-align: left; cursor: pointer; color: #333; font-size: 1rem; border-bottom: 1px solid #ccc;">
                📚 Mis Clases
            </button>
            <button type="button" id="menu-admin-login" role="menuitem" aria-label="Login Admin" style="display: block; width: 100%; padding: 15px 20px; background: #fff; border: none; text-align: left; cursor: pointer; color: #333; font-size: 1rem; border-bottom: 1px solid #ccc;">
                🔐 Login Admin
            </button>
            <button type="button" id="menu-logout" role="menuitem" aria-label="Cerrar Sesión" style="display: none; width: 100%; padding: 15px 20px; background: #fff; border: none; text-align: left; cursor: pointer; color: #333; font-size: 1rem;">
                🚪 Cerrar Sesión
            </button>
            <button type="button" id="menu-admin-logout" role="menuitem" aria-label="Cerrar Sesión Admin" style="display: none; width: 100%; padding: 15px 20px; background: #fff; border: none; text-align: left; cursor: pointer; color: #333; font-size: 1rem;">
                🚪 Cerrar Sesión Admin
            </button>
        </div>
    </div>

    <!-- Modal para Registro de Usuario -->
    <!-- Modal de Registro - Usado para ambos: crear cuenta completa Y registro rápido para pago -->
    <div id="register-modal" role="dialog" aria-labelledby="register-modal-title" aria-modal="true" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:9999; justify-content:center; align-items:center;">
      <div style="background:#fff; padding:40px; border-radius:20px; max-width:400px; width:90%; text-align:center; box-shadow:0 20px 60px rgba(246,200,199,0.4); border:3px solid #EFE9E1;">
        <h2 id="register-modal-title" style="color:#333; margin-bottom:15px;">¡Bienvenida a Aura!</h2>
        <p style="color:#666; margin-bottom:20px;">Ingresa tus datos para continuar</p>
        <input type="text" id="quick-name" placeholder="Nombre completo" aria-label="Nombre completo" autocomplete="name" required style="width:100%; padding:15px; margin-bottom:15px; border:1px solid #EFE9E1; border-radius:12px; font-size:1.1rem;">
        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
          <span style="font-size: 1.3rem; font-weight: 600; color: #999; background: #f8f8f8; padding: 15px 12px; border-radius: 12px 0 0 12px; border: 1px solid #EFE9E1; border-right: none;">+52</span>
          <input type="tel" id="quick-phone-digits" placeholder="715 159 6586" maxlength="10" pattern="[0-9]{10}" inputmode="numeric" autocomplete="tel" style="flex: 1; padding: 15px; border: 1px solid #EFE9E1; border-radius: 0 12px 12px 0; font-size: 1.1rem;" required>
        </div>
        <div style="margin-bottom: 20px;">
          <input type="password" id="quick-password" placeholder="Crear contraseña (mínimo 4 caracteres)" aria-label="Crear contraseña" autocomplete="new-password" minlength="4" required style="width:100%; padding:15px; border:1px solid #EFE9E1; border-radius:12px; font-size:1.1rem; box-sizing: border-box;">
          <p style="color:#999; font-size:0.85rem; margin-top:6px; text-align:left;">Esta contraseña te permitirá ver tus clases</p>
        </div>
        <div style="display:flex; gap:15px;">
          <button type="button" onclick="guardarRegistroLocalYPagar()" style="flex:1; background:#EFE9E1; color:white; padding:15px; border:none; border-radius:12px; font-size:1.1rem; cursor:pointer;">Continuar</button>
          <button type="button" onclick="document.getElementById('register-modal').style.display='none'" style="flex:1; background:#eee; color:#666; padding:15px; border:none; border-radius:12px; font-size:1.1rem; cursor:pointer;">Cancelar</button>
        </div>
      </div>
    </div>

    <!-- Modal para Login de Usuario (Mis Clases) -->
    <div id="user-login-modal" role="dialog" aria-labelledby="user-login-modal-title" aria-modal="true" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:9999; justify-content:center; align-items:center;">
      <div style="background:#fff; padding:40px; border-radius:20px; max-width:400px; width:90%; text-align:center; box-shadow:0 20px 60px rgba(246,200,199,0.4); border:3px solid #EFE9E1;">
        <h2 id="user-login-modal-title" style="color:#333; margin-bottom:15px;">📚 Mis Clases</h2>
        <p style="color:#666; margin-bottom:20px;">Ingresa tus datos para ver tus clases agendadas</p>
        <div id="user-login-error" style="display: none; background: linear-gradient(135deg, #EFE9E1 0%, #EFE9E1 100%); color: #fff; padding: 12px; border-radius: 10px; margin-bottom: 15px; text-align: center; font-size: 0.9rem;"></div>
        <form id="user-login-form">
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
              <span style="font-size: 1.3rem; font-weight: 600; color: #999; background: #f8f8f8; padding: 15px 12px; border-radius: 12px 0 0 12px; border: 1px solid #EFE9E1; border-right: none;">+52</span>
              <input type="tel" id="user-login-phone" placeholder="10 dígitos" maxlength="10" pattern="[0-9]{10}" inputmode="numeric" autocomplete="tel" style="flex: 1; padding: 15px; border: 1px solid #EFE9E1; border-radius: 0 12px 12px 0; font-size: 1.1rem;" required>
            </div>
            <div style="margin-bottom: 20px;">
              <input type="password" id="user-login-password" placeholder="Contraseña" autocomplete="current-password" style="width:100%; padding:15px; border:1px solid #EFE9E1; border-radius:12px; font-size:1.1rem; box-sizing: border-box;" required>
            </div>
            <div style="display:flex; gap:15px;">
              <button type="submit" style="flex:1; background:#EFE9E1; color:white; padding:15px; border:none; border-radius:12px; font-size:1.1rem; cursor:pointer;">Ver Mis Clases</button>
              <button type="button" id="user-login-cancel" style="flex:1; background:#eee; color:#666; padding:15px; border:none; border-radius:12px; font-size:1.1rem; cursor:pointer;">Cancelar</button>
            </div>
        </form>
      </div>
    </div>

    <!-- Modal para Selección de Horario -->
    <div id="time-selection-modal" role="dialog" aria-labelledby="time-modal-title" aria-modal="true" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 2000; justify-content: center; align-items: center;">
        <div style="background: linear-gradient(135deg, #ffffff 0%, #EFE9E1 100%); padding: 40px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2); max-width: 450px; width: 90%; border: 2px solid rgba(239, 233, 225, 0.3);">
            <h2 id="time-modal-title" style="color: #333; margin-bottom: 10px; font-size: 1.8rem; font-weight: 600;">Selecciona tu Horario</h2>
            <p id="time-modal-date" style="color: #666; margin-bottom: 20px; font-size: 1rem; font-weight: 500;"></p>
            <div style="margin-bottom: 20px;">
                <p style="color: #666; font-weight: 500; margin-bottom: 10px;">🌅 Horarios Disponibles:</p>
                <div id="time-slots-container" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; max-height: 400px; overflow-y: auto; padding: 10px; background: rgba(239, 233, 225, 0.05); border-radius: 10px;">
                    <!-- Time slots will be generated here -->
                </div>
            </div>
            <div style="display: flex; gap: 10px;">
                <button type="button" id="time-cancel" style="flex: 1; background: #e0e0e0; color: #666; padding: 12px 20px; border: 1px solid #ccc; font-size: 1rem; cursor: pointer;">
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal para Confirmación de Reserva (Nombre + Teléfono + Pagar) -->
    <div id="reservation-modal" role="dialog" aria-modal="true" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 2100; justify-content: center; align-items: center;">
        <div style="background: linear-gradient(135deg, #ffffff 0%, #EFE9E1 100%); padding: 40px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2); max-width: 500px; width: 90%; border: 2px solid rgba(239, 233, 225, 0.3);">
            <h2 style="color: #333; margin-bottom: 20px; font-size: 1.8rem; font-weight: 600; text-align: center;">Confirma tu Reserva</h2>
            
            <!-- Información del horario seleccionado -->
            <div style="background: rgba(239, 233, 225, 0.1); padding: 20px; border-radius: 12px; margin-bottom: 25px; border: 1px solid rgba(239, 233, 225, 0.3);">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                    <span style="font-size: 1.5rem;">📅</span>
                    <span id="reservation-date-display" style="color: #333; font-weight: 600; font-size: 1.1rem;"></span>
                </div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 1.5rem;">🕐</span>
                    <span id="reservation-time-display" style="color: #666; font-weight: 500; font-size: 1.05rem;"></span>
                </div>
            </div>
            
            <!-- Formulario de datos del cliente -->
            <div style="margin-bottom: 25px;">
                <label for="reservation-name" style="display: block; color: #666; font-weight: 600; margin-bottom: 8px; font-size: 0.95rem;">Nombre Completo</label>
                <input type="text" id="reservation-name" placeholder="Ej: María García" autocomplete="name" style="width: 100%; padding: 14px; border: 2px solid rgba(239, 233, 225, 0.3); border-radius: 10px; font-size: 1rem; transition: all 0.3s ease;" onfocus="this.style.borderColor='#EFE9E1'" onblur="this.style.borderColor='rgba(239, 233, 225, 0.3)'" />
            </div>
            
            <div style="margin-bottom: 25px;">
                <label for="reservation-phone" style="display: block; color: #666; font-weight: 600; margin-bottom: 8px; font-size: 0.95rem;">Teléfono (10 dígitos)</label>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="padding: 14px; background: rgba(239, 233, 225, 0.1); border: 2px solid rgba(239, 233, 225, 0.3); border-radius: 10px; font-weight: 600; color: #333;">+52</span>
                    <input type="tel" id="reservation-phone" placeholder="1234567890" maxlength="10" pattern="[0-9]{10}" autocomplete="tel" style="flex: 1; padding: 14px; border: 2px solid rgba(239, 233, 225, 0.3); border-radius: 10px; font-size: 1rem; transition: all 0.3s ease;" onfocus="this.style.borderColor='#EFE9E1'" onblur="this.style.borderColor='rgba(239, 233, 225, 0.3)'" />
                </div>
                <p style="color: #999; font-size: 0.85rem; margin-top: 6px;">Solo números, sin espacios ni guiones</p>
            </div>
            
            <!-- Contador de clases seleccionadas -->
            <div style="background: rgba(239, 233, 225, 0.1); padding: 15px; border-radius: 10px; margin-bottom: 25px; text-align: center;">
                <p style="color: #666; font-size: 0.95rem; margin-bottom: 5px;">Progreso de reservas</p>
                <p id="reservation-progress" style="color: #333; font-weight: 700; font-size: 1.3rem;"></p>
            </div>
            
            <!-- Botones de acción -->
            <div style="display: flex; gap: 12px;">
                <button type="button" id="reservation-cancel" style="flex: 1; background: #e0e0e0; color: #666; padding: 16px; border: 1px solid #ccc; border-radius: 10px; font-size: 1.05rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='#d0d0d0'" onmouseout="this.style.background='#e0e0e0'">
                    Cancelar
                </button>
                <button type="button" id="reservation-confirm" style="flex: 2; background: linear-gradient(135deg, #EFE9E1 0%, #EFE9E1 100%); color: #fff; padding: 16px; border: 2px solid #EFE9E1; border-radius: 10px; font-size: 1.05rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(239, 233, 225, 0.4);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(239, 233, 225, 0.6)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(239, 233, 225, 0.4)'">
                    Reservar y pagar ahora
                </button>
            </div>
        </div>
    </div>



    <!-- ========== 1. Welcome Section (Hero Section) ========== -->
    <section class="hero-section">
        <!-- Video Background -->
        <video id="hero-video" class="hero-video-background" autoplay loop muted playsinline preload="auto" disablepictureinpicture disableremoteplayback>
            <source src="videoaura155.mp4" type="video/mp4">
            <!-- Fallback for browsers that don't support video -->
        </video>
        
        <!-- Overlay for better text readability -->
        <div class="hero-overlay"></div>
        
        <div class="hero-content">
            <h1>Más que pilates,</h1>
            <h2>una forma de vida</h2>
            <a href="#booking" class="hero-btn">Agendar Clase</a>
        </div>
    </section>

    <!-- ========== 2. About Section (Pilates Studio Cards) ========== -->
    <section class="about-section">
        <h2>Pilates Studio</h2>
        <div class="pilates-cards-container">
            <div class="pilates-card" onclick="togglePilatesCard(this)">
                <img class="pilates-card-image" src="https://images.pexels.com/photos/14843495/pexels-photo-14843495.jpeg" alt="Pilates Studio">
                <div class="pilates-card-overlay">
                    <h3 class="pilates-card-title">Pilates Studio</h3>
                    <p class="pilates-card-text">En Aura Studio, nuestra misión es promover el bienestar físico y mental a través del Pilates. Creemos que cada persona puede alcanzar su máximo potencial con las herramientas adecuadas.</p>
                </div>
            </div>

            <div class="pilates-card" onclick="togglePilatesCard(this)">
                <img class="pilates-card-image" src="https://images.pexels.com/photos/5012112/pexels-photo-5012112.jpeg" alt="Pilates Instructor">
                <div class="pilates-card-overlay">
                    <h3 class="pilates-card-title">Pilates Instructor</h3>
                    <p class="pilates-card-text">Ofrecemos un enfoque personalizado en cada clase de Pilates, adaptando los ejercicios a las necesidades individuales de nuestras alumnas. Nuestro equipo de instructoras certificadas está comprometida con tu progreso y salud.</p>
                </div>
            </div>

            <div class="pilates-card" onclick="togglePilatesCard(this)">
                <img class="pilates-card-image" src="https://images.pexels.com/photos/6975235/pexels-photo-6975235.jpeg" alt="Pilates Practice">
                <div class="pilates-card-overlay">
                    <h3 class="pilates-card-title">Pilates Practice</h3>
                    <p class="pilates-card-text">Entrena con nosotras, mejora la flexibilidad, la fuerza y la postura. En Aura Studio, te enseñamos cómo estos beneficios pueden transformar tu vida diaria y ayudarte a lograr un equilibrio integral.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- ========== 3. Booking Section ========== -->
    <section id="booking" class="booking-section">
        <div class="booking-container">
            <h2>Citas en Línea</h2>
            
            <div class="plans-grid">
                <div class="plan-card">
                    <div class="bg"></div>
                    <div class="blob"></div>
                    <h3>1 Clase</h3>
                    <div class="price">$50</div>
                    <button type="button" class="plan-btn" data-title="1 Clases" data-price="50">Agendar Clase</button>
                </div>

                <div class="plan-card">
                    <div class="bg"></div>
                    <div class="blob"></div>
                    <h3>4 Clases</h3>
                    <div class="price">$540</div>
                    <div class="savings">Ahorras $60</div>
                    <button type="button" class="plan-btn" data-title="4 Clases" data-price="540">Agendar Clase</button>
                </div>

                <div class="plan-card">
                    <div class="bg"></div>
                    <div class="blob"></div>
                    <h3>8 Clases</h3>
                    <div class="price">$1000</div>
                    <div class="savings">Ahorras $200</div>
                    <button type="button" class="plan-btn" data-title="8 Clases" data-price="1000">Agendar Clase</button>
                </div>

                <div class="plan-card">
                    <div class="bg"></div>
                    <div class="blob"></div>
                    <h3>12 Clases</h3>
                    <div class="price">$1400</div>
                    <div class="savings">Ahorras $400</div>
                    <button type="button" class="plan-btn" data-title="12 Clases" data-price="1400">Agendar Clase</button>
                </div>

                <div class="plan-card">
                    <div class="bg"></div>
                    <div class="blob"></div>
                    <h3>15 Clases</h3>
                    <div class="price">$1600</div>
                    <div class="savings">Ahorras $650</div>
                    <button type="button" class="plan-btn" data-title="15 Clases" data-price="1600">Agendar Clase</button>
                </div>
            </div>

            <div id="calendar-container">
                <div class="calendar-info">
                    <h3>📅 Selecciona tus Clases</h3>
                    <p><strong>Horarios Disponibles:</strong></p>
                    <p>🌅 Mañana: 6:00 AM - 11:00 AM</p>
                    <p>🌆 Tarde: 5:00 PM - 8:00 PM</p>
                    <p><strong>Días:</strong> Lunes a Sábado</p>
                    <div class="calendar-legend">
                        <div class="legend-item">
                            <div class="legend-color legend-available"></div>
                            <span>Horarios Disponibles</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color legend-booked"></div>
                            <span>Tus Clases Reservadas</span>
                        </div>
                    </div>
                </div>
                <div id="calendar"></div>
            </div>
        </div>
    </section>

    <!-- ========== 3.5. My Classes Section ========== -->
    <section id="my-classes-section" class="my-classes-section">
        <h2 id="my-classes-greeting">📚 Mis Clases</h2>
        <div class="my-classes-container">
            <!-- Loading state -->
            <div id="my-classes-loading" class="my-classes-loading" style="display: none;">
                <div class="my-classes-loading-spinner"></div>
                <p style="margin-top: 20px; font-size: 1.1rem;">Cargando tus clases...</p>
            </div>

            <!-- Empty state -->
            <div id="my-classes-empty" class="my-classes-empty" style="display: none;">
                <div class="my-classes-empty-icon">📅</div>
                <p>No tienes clases agendadas aún.</p>
                <p style="margin-top: 10px; font-size: 1rem; color: #999;">
                    <a href="#booking" style="color: #EFE9E1; text-decoration: underline;">Agenda tu primera clase aquí</a>
                </p>
            </div>

            <!-- Classes grid -->
            <div id="my-classes-grid" class="my-classes-grid">
                <!-- Classes will be dynamically loaded here -->
            </div>
        </div>
    </section>

    <!-- ========== 4. Image Scroll Section ========== -->
    <section class="image-scroll-section">
        <h2>Nuestras Instalaciones</h2>
        <div class="image-scroll-container">
            <div class="image-wrapper" onclick="likeImage(this)">
                <img src="STUDIO1.jpeg" alt="Studio 1" class="scroll-image">
                <div class="heart-overlay">♡</div>
            </div>
            <div class="image-wrapper" onclick="likeImage(this)">
                <img src="STUDIO2.jpeg" alt="Studio 2" class="scroll-image">
                <div class="heart-overlay">♡</div>
            </div>
            <div class="image-wrapper" onclick="likeImage(this)">
                <img src="STUDIO3.jpeg" alt="Studio 3" class="scroll-image">
                <div class="heart-overlay">♡</div>
            </div>
            <div class="image-wrapper" onclick="likeImage(this)">
                <img src="STUDIO4.jpeg" alt="Studio 4" class="scroll-image">
                <div class="heart-overlay">♡</div>
            </div>
            <div class="image-wrapper" onclick="likeImage(this)">
                <img src="STUDIO5.jpeg" alt="Studio 5" class="scroll-image">
                <div class="heart-overlay">♡</div>
            </div>
            <div class="image-wrapper" onclick="likeImage(this)">
                <img src="STUDIO6.jpeg" alt="Studio 6" class="scroll-image">
                <div class="heart-overlay">♡</div>
            </div>
            <div class="image-wrapper" onclick="likeImage(this)">
                <img src="STUDIO7.jpeg" alt="Studio 7" class="scroll-image">
                <div class="heart-overlay">♡</div>
            </div>
            <div class="image-wrapper" onclick="likeImage(this)">
                <img src="STUDIO8.jpeg" alt="Studio 8" class="scroll-image">
                <div class="heart-overlay">♡</div>
            </div>
            <div class="image-wrapper" onclick="likeImage(this)">
                <img src="STUDIO9.jpeg" alt="Studio 9" class="scroll-image">
                <div class="heart-overlay">♡</div>
            </div>
            <div class="image-wrapper" onclick="likeImage(this)">
                <img src="STUDIO10.jpeg" alt="Studio 10" class="scroll-image">
                <div class="heart-overlay">♡</div>
            </div>
            <div class="image-wrapper" onclick="likeImage(this)">
                <img src="STUDIO11.jpeg" alt="Studio 11" class="scroll-image">
                <div class="heart-overlay">♡</div>
            </div>
            <div class="image-wrapper" onclick="likeImage(this)">
                <img src="STUDIO12.jpeg" alt="Studio 12" class="scroll-image">
                <div class="heart-overlay">♡</div>
            </div>
            <div class="image-wrapper" onclick="likeImage(this)">
                <img src="STUDIO13.jpeg" alt="Studio 13" class="scroll-image">
                <div class="heart-overlay">♡</div>
            </div>
        </div>
    </section>

    <!-- ========== 5. Admin Login Section (Modal Style) ========== -->
    <div id="admin-login-modal" role="dialog" aria-labelledby="admin-login-modal-title" aria-modal="true" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 2000; justify-content: center; align-items: center;">
        <div style="background: linear-gradient(135deg, #ffffff 0%, #EFE9E1 100%); padding: 40px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2); max-width: 400px; width: 90%; border: 2px solid rgba(239, 233, 225, 0.3);">
            <h2 id="admin-login-modal-title" style="color: #333; margin-bottom: 10px; font-size: 1.8rem; font-weight: 600;">Acceso de Administrador</h2>
            <p style="color: #666; margin-bottom: 20px; font-size: 0.95rem;">Ingresa con tu cuenta de administrador</p>
            <div id="login-error" style="display: none; background: linear-gradient(135deg, #EFE9E1 0%, #EFE9E1 100%); color: #fff; padding: 12px; border-radius: 10px; margin-bottom: 15px; text-align: center; font-size: 0.9rem;"></div>
            <form id="admin-login-form">
                <div style="margin-bottom: 15px;">
                    <label for="admin-email" style="display: block; margin-bottom: 5px; color: #666; font-weight: 500; font-size: 0.95rem;">Correo Electrónico</label>
                    <input type="email" id="admin-email" required autocomplete="username" style="width: 100%; padding: 12px; border: 1px solid rgba(239, 233, 225, 0.5); border-radius: 10px; font-size: 1rem; transition: all 0.3s ease; box-sizing: border-box;">
                </div>
                <div style="margin-bottom: 20px;">
                    <label for="admin-password" style="display: block; margin-bottom: 5px; color: #666; font-weight: 500; font-size: 0.95rem;">Contraseña</label>
                    <input type="password" id="admin-password" required autocomplete="current-password" style="width: 100%; padding: 12px; border: 1px solid rgba(239, 233, 225, 0.5); border-radius: 10px; font-size: 1rem; transition: all 0.3s ease; box-sizing: border-box;">
                </div>
                <div style="display: flex; gap: 10px;">
                    <button type="submit" style="flex: 1; background: #EFE9E1; color: #fff; padding: 12px 20px; border: 1px solid #ccc; font-size: 1rem; cursor: pointer;">
                        Iniciar Sesión
                    </button>
                    <button type="button" id="admin-login-cancel" style="flex: 1; background: #e0e0e0; color: #666; padding: 12px 20px; border: 1px solid #ccc; font-size: 1rem; cursor: pointer;">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ========== 6. Admin Panel Section ========== -->
    <section id="admin-panel-section" class="contact-section" style="display: none;">
        <h2>Panel de Administrador</h2>
        <p style="margin-bottom: 10px;">Hola <span id="admin-email-display">Michel</span></p>
        <button type="button" id="admin-logout-btn" class="contact-btn" style="margin-bottom: 30px;">Cerrar Sesión</button>
        
        <!-- Contenedor principal: en móvil, el calendario se separa para ocupar todo el ancho -->
        <div id="admin-panel-container" style="max-width: 1400px; margin: 0 auto; background: linear-gradient(135deg, #ffffff 0%, #EFE9E1 100%); padding: 50px; border-radius: 25px; box-shadow: 0 15px 50px rgba(0, 0, 0, 0.12); border: 2px solid rgba(239, 233, 225, 0.3);">
            <div style="margin-bottom: 40px;">
                <h3 style="color: #333; margin: 0; font-size: 2.2rem; font-weight: 600; text-align: center; letter-spacing: 1px;">📅 Calendario de Reservas</h3>
            </div>
            
            <div id="reservations-loading" style="text-align: center; padding: 40px; color: #666;">
                <p style="font-size: 1.1rem;">Cargando reservas...</p>
            </div>
            
            <!-- Statistics Summary -->
            <div id="admin-stats-section" style="display: none;">
                <div class="admin-stats-summary">
                    <div class="stat-card">
                        <div class="stat-icon">📊</div>
                        <div class="stat-value" id="stat-total-reservations">0</div>
                        <div class="stat-label">Total Reservas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">📅</div>
                        <div class="stat-value" id="stat-this-week">0</div>
                        <div class="stat-label">Esta Semana</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">👥</div>
                        <div class="stat-value" id="stat-unique-clients">0</div>
                        <div class="stat-label">Clientes Únicos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">⭐</div>
                        <div class="stat-value" id="stat-upcoming">0</div>
                        <div class="stat-label">Próximas</div>
                    </div>
                </div>
            </div>
            
            <!-- Calendar Controls -->
            <div id="admin-calendar-controls" style="display: none;">
                <div class="admin-calendar-controls">
                    <input type="text" id="search-client" placeholder="🔍 Buscar por cliente..." style="flex: 1; min-width: 200px;">
                    <input type="date" id="filter-date-start" placeholder="Desde">
                    <input type="date" id="filter-date-end" placeholder="Hasta">
                    <button type="button" id="btn-filter-apply">🔍 Filtrar</button>
                    <button type="button" id="btn-filter-clear">✖️ Limpiar</button>
                    <button type="button" id="btn-refresh-calendar">🔄 Actualizar</button>
                    <button type="button" id="btn-export-calendar">📥 Exportar</button>
                </div>
            </div>
            
            <!-- Calendar View for Admin -->
            <div id="admin-calendar-view" style="display: none;">
                <div id="admin-calendar"></div>
            </div>
            
            <div id="no-reservations" style="display: none; text-align: center; padding: 40px; color: #666;">
                <p style="font-size: 1.1rem;">No hay reservas en este momento.</p>
            </div>
        </div>
        
        <!-- Event Detail Modal -->
        <div id="event-detail-modal" class="event-detail-modal">
            <div class="event-detail-content">
                <div class="event-detail-header">
                    <h3>👤 Detalle de Reserva</h3>
                    <button type="button" class="event-detail-close" id="event-detail-close">×</button>
                </div>
                <div class="event-detail-body">
                    <div class="event-detail-row">
                        <div class="event-detail-icon">👤</div>
                        <div class="event-detail-info">
                            <div class="event-detail-label">Cliente</div>
                            <div class="event-detail-value" id="detail-client-name">-</div>
                        </div>
                    </div>
                    <div class="event-detail-row">
                        <div class="event-detail-icon">📱</div>
                        <div class="event-detail-info">
                            <div class="event-detail-label">Teléfono</div>
                            <div class="event-detail-value" id="detail-client-email">-</div>
                        </div>
                    </div>
                    <div class="event-detail-row">
                        <div class="event-detail-icon">📅</div>
                        <div class="event-detail-info">
                            <div class="event-detail-label">Fecha</div>
                            <div class="event-detail-value" id="detail-date">-</div>
                        </div>
                    </div>
                    <div class="event-detail-row">
                        <div class="event-detail-icon">🕐</div>
                        <div class="event-detail-info">
                            <div class="event-detail-label">Horario</div>
                            <div class="event-detail-value" id="detail-time">-</div>
                        </div>
                    </div>
                    <div class="event-detail-row" id="detail-notes-row" style="display: none;">
                        <div class="event-detail-icon">📝</div>
                        <div class="event-detail-info">
                            <div class="event-detail-label">Notas</div>
                            <div class="event-detail-value" id="detail-notes">-</div>
                        </div>
                    </div>
                </div>
                <div class="event-detail-actions">
                    <button type="button" class="btn-secondary" id="detail-close-btn">Cerrar</button>
                    <button type="button" class="btn-primary" id="detail-contact-btn">📧 Contactar</button>
                </div>
            </div>
        </div>
    </section>

    <!-- ========== 7. Contact Section ========== -->
    <section class="contact-section">
        <h2>Comunícate con Nosotros</h2>
        <p>WhatsApp</p>
        <p>¿Preguntas?</p>
        <p>¡Estamos aquí para ti!</p>
        <p>Escríbenos y nuestro equipo te dará seguimiento exclusivo.</p>
        <a href="https://wa.me/+527151596586" class="contact-btn" target="_blank">Envíanos un mensaje</a>
        <p class="hours">Abre hoy: 06:00 a.m. – 08:00 p.m.</p>
    </section>

    <!-- ========== 8. Reglamento Link Section ========== -->
    <section class="reglamento-link">
        <a id="reglamento-link" href="javascript:void(0);">Leer Reglamento Aura</a>
    </section>

    <!-- ========== Reglamento Modal ========== -->
    <div id="reglamento-modal" class="reglamento-modal">
        <div class="reglamento-content">
            <h2>REGLAMENTO</h2>
            <p>El objetivo de estas reglas es asegurar un ambiente seguro, respetuoso y óptimo para la práctica de Pilates de todos nuestros alumnos.</p>
            
            <h3>Salud y seguridad Tu bienestar es lo primero!</h3>
            <p>Es obligatorio notificar a tu instructor sobre cualquier lesión, dolor crónico, embarazo o condición médica antes de iniciar la clase. Esto permite adaptar los ejercicios a tus necesidades.</p>
            
            <h3>Escucha a tu cuerpo</h3>
            <p>Si sientes dolor, mareo o malestar, detente inmediatamente e informa a tu instructor. Los ejercicios no son obligatorios si causan incomodidad.</p>
            
            <h3>Uso del equipo</h3>
            <p>Utiliza el equipo siguiendo estrictamente las indicaciones del instructor para evitar accidentes y daños al material.</p>
            
            <h3>Calcetines antideslizantes</h3>
            <p>Es imprescindible usar calcetines antideslizantes en todo momento dentro del estudio, por motivos de higiene y seguridad.</p>
            
            <h3>Ropa adecuada</h3>
            <p>Asiste con ropa deportiva cómoda y limpia. Se recomienda ropa ajustada para que el instructor pueda observar mejor tu alineación.</p>
            
            <h3>Limpieza del equipo</h3>
            <p>Al finalizar tu sesión, por favor limpia el equipo que utilizaste (Reformer, accesorios, etc.) con los productos de higiene que el estudio proporciona.</p>
            
            <h3>Toalla personal</h3>
            <p>Te sugerimos traer una toalla de mano para el sudor, y en algunos casos, para colocar sobre el equipo.</p>
            
            <h3>Hidratación</h3>
            <p>Solo se permite ingresar al estudio con botellas de agua cerradas y con tapa.</p>
            
            <h3>Locker y pertenencias</h3>
            <p>Los lockers se pueden usar durante el tiempo que el alumno permanezca en las instalaciones del estudio. No se permite dejar objetos personales después de finalizar su clase. De lo contrario, Aura Studio no se hace responsable por pérdidas.</p>
            
            <h3>Ingreso exclusivo para usuarios inscritos</h3>
            <p>Es obligatorio registrar la entrada y no se permite el ingreso de acompañantes, para mayor comodidad de todos.</p>
            
            <h3>Reservaciones</h3>
            <p>Al momento de reservar se debe depositar el pago de la clase/paquete, de lo contrario no se tomará en cuenta su reservación. Reserva de clases Es obligatorio reservar las clases con antelación.</p>
            
            <h3>CLASES NO TRANSFERIBLES</h3>
            <p>Las reservas y las cuotas suelen ser personales e intransferibles, por ninguna circunstancia.</p>
            
            <h3>Pago Anticipado</h3>
            <p>Los pagos de nuevos paquetes deben ser cubiertos en un lapso de 1-2 días antes de que este inicie.</p>
            
            <h3>Clases NO Reembolsables</h3>
            <p>Las clases no son reembolsables ni transferibles, en dado caso de no asistir, clase perdida.</p>
            
            <h3>Clases no modificables</h3>
            <p>Responsabilidad a la hora de agendar, porque los horarios no pueden ser modificados.</p>
            
            <h3>Teléfono Móvil</h3>
            <p>Debe estar en silencio o apagado durante toda la sesión, para evitar interrupciones y fomentar la concentración.</p>
            
            <h3>Respeto</h3>
            <p>Mantener comportamiento respetuoso hacia los instructores, personal y demás clientes.</p>
            
            <h3>Equipos y espacios</h3>
            <p>Cuida los aparatos, NO azotar las máquinas ni dejar caer el material de entrenamiento.</p>
            
            <h3>Sanciones</h3>
            <p>El incumplimiento del reglamento puede acarrear llamados de atención, suspensión temporal o cancelación de la membresía.</p>
            
            <h3>Grabaciones</h3>
            <p>Por respeto a la privacidad y derechos de autor, no se permite grabar las clases completas.</p>
            
            <h3>Tolerancia</h3>
            <p>Las clases comienzan a la hora establecida. Tolerancia de 5 minutos para ingresar, y no se permite el acceso después de ese tiempo para evitar interrupciones y, lo más importante, asegurar que el alumno realice el calentamiento completo para prevenir lesiones.</p>
            
            <p style="text-align: center; margin-top: 30px; font-weight: 600;">Agradecemos su comprensión.<br>Aura Studio</p>
            
            <button type="button" class="reglamento-close" id="reglamento-close">Cerrar</button>
        </div>
    </div>

    <!-- FullCalendar v6.1.15 JS desde CDN -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>
    <!-- FullCalendar locales para español -->
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/core@6.1.15/locales/es.global.min.js"></script>
    
    <!-- ========== Hamburger Menu Functionality ========== -->
    <script>
        /*
         * Funcionalidad del Menú Hamburguesa
         * - Toggle para mostrar/ocultar menú
         * - Navegación a modales de registro y login
         * - Botón de logout visible solo cuando hay sesión activa
         * - Accesibilidad con ARIA labels
         * - Responsive y funcional en móviles
         */
        
        document.addEventListener('DOMContentLoaded', () => {
            const hamburgerBtn = document.getElementById('hamburger-btn');
            const menuDropdown = document.getElementById('menu-dropdown');
            const menuRegister = document.getElementById('menu-register');
            const menuMyClasses = document.getElementById('menu-my-classes');
            const menuAdminLogin = document.getElementById('menu-admin-login');
            const menuLogout = document.getElementById('menu-logout');
            
            const registerModal = document.getElementById('register-modal');
            const userLoginModal = document.getElementById('user-login-modal');
            const userLoginCancel = document.getElementById('user-login-cancel');
            const adminLoginModal = document.getElementById('admin-login-modal');
            const adminLoginCancel = document.getElementById('admin-login-cancel');
            
            // Toggle hamburger menu
            hamburgerBtn.addEventListener('click', () => {
                const isOpen = menuDropdown.style.display === 'block';
                menuDropdown.style.display = isOpen ? 'none' : 'block';
                hamburgerBtn.setAttribute('aria-expanded', !isOpen);
                menuDropdown.setAttribute('aria-hidden', isOpen);
            });
            
            // Close menu when clicking outside
            document.addEventListener('click', (e) => {
                if (!hamburgerBtn.contains(e.target) && !menuDropdown.contains(e.target)) {
                    menuDropdown.style.display = 'none';
                    hamburgerBtn.setAttribute('aria-expanded', 'false');
                    menuDropdown.setAttribute('aria-hidden', 'true');
                }
            });
            
            // Hover effects for menu items
            const menuItems = [menuRegister, menuMyClasses, menuAdminLogin, menuLogout];
            menuItems.forEach(item => {
                item.addEventListener('mouseenter', () => {
                    item.style.background = 'linear-gradient(135deg, #EFE9E1 0%, #EFE9E1 100%)';
                });
                item.addEventListener('mouseleave', () => {
                    item.style.background = 'transparent';
                });
            });
            
            // Show register modal
            menuRegister.addEventListener('click', () => {
                menuDropdown.style.display = 'none';
                hamburgerBtn.setAttribute('aria-expanded', 'false');
                menuDropdown.setAttribute('aria-hidden', 'true');
                registerModal.style.display = 'flex';
                document.getElementById('quick-name').focus();
            });
            
            // Show user login modal (Mis Clases)
            menuMyClasses.addEventListener('click', () => {
                menuDropdown.style.display = 'none';
                hamburgerBtn.setAttribute('aria-expanded', 'false');
                menuDropdown.setAttribute('aria-hidden', 'true');
                userLoginModal.style.display = 'flex';
                document.getElementById('user-login-phone').focus();
            });
            
            // Close user login modal
            userLoginCancel.addEventListener('click', () => {
                userLoginModal.style.display = 'none';
                document.getElementById('user-login-form').reset();
                document.getElementById('user-login-error').style.display = 'none';
            });
            
            // Close user login modal when clicking outside
            userLoginModal.addEventListener('click', (e) => {
                if (e.target === userLoginModal) {
                    userLoginModal.style.display = 'none';
                    document.getElementById('user-login-form').reset();
                    document.getElementById('user-login-error').style.display = 'none';
                }
            });
            
            // Handle user login form submission (Mis Clases)
            document.getElementById('user-login-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const phoneDigits = document.getElementById('user-login-phone').value.trim();
                const password = document.getElementById('user-login-password').value;
                const errorDiv = document.getElementById('user-login-error');
                
                // Validate phone number
                if (!phoneDigits || !/^\d{10}$/.test(phoneDigits)) {
                    errorDiv.textContent = '⚠️ Ingresa 10 dígitos del teléfono';
                    errorDiv.style.display = 'block';
                    return;
                }
                
                // Validate password (basic validation - minimum 4 characters)
                if (!password || password.length < 4) {
                    errorDiv.textContent = '⚠️ Ingresa tu contraseña';
                    errorDiv.style.display = 'block';
                    return;
                }
                
                // Verify password against stored hashed password for this phone number
                const storedPasswordHash = localStorage.getItem('userPassword_' + phoneDigits);
                if (!storedPasswordHash) {
                    errorDiv.textContent = '⚠️ No hay cuenta registrada con este teléfono. Por favor regístrate primero.';
                    errorDiv.style.display = 'block';
                    return;
                }
                
                // Hash the entered password for comparison
                const encoder = new TextEncoder();
                const data = encoder.encode(password);
                const hashBuffer = await crypto.subtle.digest('SHA-256', data);
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                const enteredPasswordHash = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
                
                if (enteredPasswordHash !== storedPasswordHash) {
                    errorDiv.textContent = '❌ Contraseña incorrecta. Intenta nuevamente.';
                    errorDiv.style.display = 'block';
                    return;
                }
                
                // Use the phone number for querying reservations
                const phoneNumber = phoneDigits;
                
                try {
                    // Store user info in localStorage for session
                    // Store with country code prefix for consistency with registration
                    localStorage.setItem('userTelefono', '52' + phoneNumber);
                    localStorage.setItem('userLoggedIn', 'true');
                    
                    // Hide modal
                    userLoginModal.style.display = 'none';
                    document.getElementById('user-login-form').reset();
                    errorDiv.style.display = 'none';
                    
                    // Load and show user's classes
                    if (typeof window.loadUserClasses === 'function') {
                        await window.loadUserClasses(phoneNumber);
                        
                        // Scroll to My Classes section
                        const myClassesSection = document.getElementById('my-classes-section');
                        if (myClassesSection) {
                            setTimeout(() => {
                                myClassesSection.scrollIntoView({ behavior: 'smooth' });
                            }, 300);
                        }
                    } else {
                        console.error('loadUserClasses function not available');
                        errorDiv.textContent = '❌ Error al cargar clases. Intenta recargar la página.';
                        errorDiv.style.display = 'block';
                    }
                    
                } catch (error) {
                    console.error('Error during user login:', error);
                    errorDiv.textContent = '❌ Error al verificar. Intenta nuevamente.';
                    errorDiv.style.display = 'block';
                }
            });
            
            // Show admin login modal
            menuAdminLogin.addEventListener('click', () => {
                menuDropdown.style.display = 'none';
                hamburgerBtn.setAttribute('aria-expanded', 'false');
                menuDropdown.setAttribute('aria-hidden', 'true');
                adminLoginModal.style.display = 'flex';
                document.getElementById('admin-email').focus();
            });
            
            // Close admin login modal
            adminLoginCancel.addEventListener('click', () => {
                adminLoginModal.style.display = 'none';
                document.getElementById('admin-login-form').reset();
                document.getElementById('login-error').style.display = 'none';
            });
            
            // Close time selection modal
            const timeCancel = document.getElementById('time-cancel');
            const timeModal = document.getElementById('time-selection-modal');
            
            timeCancel.addEventListener('click', () => {
                timeModal.style.display = 'none';
                document.body.style.overflow = ''; // Restore scrolling
            });

            // ========== Reglamento Modal Functionality ==========
            const reglamentoLink = document.getElementById('reglamento-link');
            const reglamentoModal = document.getElementById('reglamento-modal');
            const reglamentoClose = document.getElementById('reglamento-close');

            // Open reglamento modal
            reglamentoLink.addEventListener('click', () => {
                reglamentoModal.style.display = 'flex';
                document.body.style.overflow = 'hidden'; // Prevent background scrolling
            });

            // Close reglamento modal
            reglamentoClose.addEventListener('click', () => {
                reglamentoModal.style.display = 'none';
                document.body.style.overflow = 'auto'; // Restore scrolling
            });

            // Close modal when clicking outside the content
            reglamentoModal.addEventListener('click', (e) => {
                if (e.target === reglamentoModal) {
                    reglamentoModal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
            });

            // Close modal with ESC key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && reglamentoModal.style.display === 'flex') {
                    reglamentoModal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
            });
            
            // Close modals on ESC key
            const reservationModal = document.getElementById('reservation-modal');
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    // Check if time-selection-modal or reservation-modal is visible before closing
                    if (timeModal.style.display === 'flex' || reservationModal.style.display === 'flex') {
                        document.body.style.overflow = ''; // Restore scrolling
                    }
                    registerModal.style.display = 'none';
                    // Reset user login modal when closing with ESC
                    if (userLoginModal.style.display === 'flex') {
                        document.getElementById('user-login-form').reset();
                        document.getElementById('user-login-error').style.display = 'none';
                    }
                    userLoginModal.style.display = 'none';
                    adminLoginModal.style.display = 'none';
                    timeModal.style.display = 'none';
                    reservationModal.style.display = 'none';
                    menuDropdown.style.display = 'none';
                    hamburgerBtn.setAttribute('aria-expanded', 'false');
                    menuDropdown.setAttribute('aria-hidden', 'true');
                }
            });
            
            // Close modals when clicking outside
            registerModal.addEventListener('click', (e) => {
                if (e.target === registerModal) {
                    registerModal.style.display = 'none';
                    // Clear input fields
                    document.getElementById('quick-name').value = '';
                    document.getElementById('quick-phone-digits').value = '';
                    document.getElementById('quick-password').value = '';
                }
            });
            
            adminLoginModal.addEventListener('click', (e) => {
                if (e.target === adminLoginModal) {
                    adminLoginModal.style.display = 'none';
                    document.getElementById('admin-login-form').reset();
                    document.getElementById('login-error').style.display = 'none';
                }
            });
            
            timeModal.addEventListener('click', (e) => {
                if (e.target === timeModal) {
                    timeModal.style.display = 'none';
                    document.body.style.overflow = ''; // Restore scrolling
                }
            });
            
            // Close reservation modal when clicking outside
            reservationModal.addEventListener('click', (e) => {
                if (e.target === reservationModal) {
                    reservationModal.style.display = 'none';
                    document.body.style.overflow = ''; // Restore scrolling
                }
            });
            
            // Hover effects for buttons
            const submitButtons = document.querySelectorAll('button[type="submit"]');
            submitButtons.forEach(btn => {
                if (btn.style.background && btn.style.background.includes('f6c8c7')) {
                    btn.addEventListener('mouseenter', () => {
                        btn.style.transform = 'translateY(-2px)';
                        btn.style.boxShadow = '0 8px 20px rgba(239, 233, 225, 0.5)';
                    });
                    btn.addEventListener('mouseleave', () => {
                        btn.style.transform = 'translateY(0)';
                        btn.style.boxShadow = '0 4px 15px rgba(239, 233, 225, 0.3)';
                    });
                }
            });
            
            // Hover effect for hamburger button
            hamburgerBtn.addEventListener('mouseenter', () => {
                hamburgerBtn.style.transform = 'scale(1.1)';
                hamburgerBtn.style.transition = 'transform 0.2s ease';
            });
            hamburgerBtn.addEventListener('mouseleave', () => {
                hamburgerBtn.style.transform = 'scale(1)';
            });
        });
    </script>

    <!-- ========== Instagram-style Like Functionality for Images ========== -->
    <script>
        /**
         * Like/Unlike functionality for facility images
         * Instagram-style animation with heart burst effect
         */
        function likeImage(imageWrapper) {
            const heartOverlay = imageWrapper.querySelector('.heart-overlay');
            const isLiked = heartOverlay.classList.contains('liked');
            
            if (isLiked) {
                // Unlike: change back to outline
                heartOverlay.classList.remove('liked');
                heartOverlay.textContent = '♡'; // Outline heart
            } else {
                // Like: fill the heart with animation
                heartOverlay.classList.add('liked');
                heartOverlay.textContent = '♥'; // Filled heart
                
                // Create and show burst animation
                const burst = document.createElement('div');
                burst.className = 'like-burst';
                burst.textContent = '♥';
                imageWrapper.appendChild(burst);
                
                // Remove burst element after animation completes
                setTimeout(() => {
                    burst.remove();
                }, 800);
            }
        }

        /**
         * Toggle Pilates card to show/hide text overlay
         * When clicked, shows text overlay on the image
         * Click again to hide the text
         */
        function togglePilatesCard(card) {
            // Close all other cards first
            const allCards = document.querySelectorAll('.pilates-card');
            allCards.forEach(c => {
                if (c !== card) {
                    c.classList.remove('active');
                }
            });
            
            // Toggle current card
            card.classList.toggle('active');
        }
    </script>
    
    <script>
        /*
         * ========== FULLCALENDAR v6.1.15 + FIREBASE INTEGRATION ==========
         * 
         * Implementación de FullCalendar para AURA Studio con integración Firebase:
         * - Vista mensual inicial (dayGridMonth) con opción a vista semanal (timeGridWeek)
         * - Calendario en español (locale: 'es')
         * - Carga dinámica de eventos desde Firestore colección 'reservas'
         * - Al hacer clic en una fecha: mostrar formulario de reservas
         * - Filtrado admin vs público: admin@aura.com ve todo, otros ven clases públicas
         * - Guarda reservas en Firestore y actualiza calendario en tiempo real
         * - Responsive y centrado con máximo 900px de ancho
         * 
         * FORMATO DE FECHAS (REQUISITO):
         * - fechaHora se guarda en formato ISO: YYYY-MM-DDTHH:mm:ss
         * - Ejemplo: "2025-11-15T10:00:00"
         * - En la tabla de admin se formatea a texto legible en español
         * - Compatible con parseo estándar de JavaScript Date
         * 
         * DEBUGGING:
         * - Verifica que el CDN de FullCalendar v6.1.15 esté cargado
         * - Verifica que Firebase esté inicializado correctamente
         * - Verifica que el div #calendar exista en el DOM
         * - Revisa la consola para errores de red o permisos de Firestore
         * - Verifica que fechaHora esté en formato ISO en Firestore
         */
        
        let calendar;
        let selectedPlan = {
            classes: 0,
            price: 0,
            bookedClasses: 0,
            bookedEvents: [],
            userInfo: null  // Guardará info del cliente (nombre, email, notas)
        };
        
        // Variable global para saber si el usuario es admin
        let isAdmin = false;

        // Helper function to detect payment return parameters
        function isPaymentReturnFromMercadoPago() {
            const params = new URLSearchParams(location.search);
            return params.has('success') || 
                   params.has('payment_id') || 
                   params.has('collection_id') || 
                   params.has('status') ||
                   params.has('error') ||
                   params.has('pending');
        }
        
        // FIX #1: Hacer selectPlan global (window.selectPlan)
        // NUEVO FLUJO: Mostrar calendario inmediatamente, pedir datos por reserva
        window.selectPlan = async function(classes, price, options = {}) {
            console.log(`📅 selectPlan llamado: ${classes} clases x $${price}`);
            
            // IMPORTANTE: No limpiar tempReservations si hay un pago pendiente de procesar
            // Esto evita perder las reservas cuando el usuario retorna de MercadoPago
            if (isPaymentReturnFromMercadoPago()) {
                console.log('⚠️ Retorno de pago detectado, no limpiar tempReservations');
                return; // Dejar que detectarRetorno maneje esto
            }
            
            // Limpiar cualquier estado previo de reservas temporales (solo si no es retorno de pago)
            localStorage.removeItem('tempReservations');
            localStorage.removeItem('tempPlanClasses');
            localStorage.removeItem('tempPlanPrice');
            
            // Guardar plan seleccionado en localStorage (sobrevive al reload)
            localStorage.setItem('tempPlanClasses', classes);
            localStorage.setItem('tempPlanPrice', price);
            
            selectedPlan.classes = classes;
            selectedPlan.price = price;
            selectedPlan.bookedClasses = 0;
            selectedPlan.bookedEvents = [];
            selectedPlan.userInfo = null;

            // Show calendar immediately WITHOUT requiring login
            const calendarContainer = document.getElementById('calendar-container');
            if (calendarContainer) {
                calendarContainer.style.display = 'block';
                console.log('📅 Calendario container mostrado');
            }
            
            // Initialize or update calendar
            if (!calendar) {
                console.log('📅 Inicializando calendario...');
                initCalendar();
            } else {
                console.log('📅 Calendario ya existe, limpiando eventos temporales...');
                // Limpiar eventos temporales
                selectedPlan.bookedEvents.forEach(eventObj => {
                    const event = calendar.getEventById(eventObj.eventId);
                    if (event) event.remove();
                });
                selectedPlan.bookedEvents = [];
                selectedPlan.bookedClasses = 0;
            }

            // Actualizar el mensaje informativo
            updateCalendarInfo();

            // Scroll to calendar
            console.log('📜 Scrolling al calendario...');
            setTimeout(() => {
                if (calendarContainer) {
                    calendarContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 100);
        };
        
        // Mantener referencia local para compatibilidad
        const selectPlan = window.selectPlan;

        // Función para actualizar el mensaje informativo del calendario
        function updateCalendarInfo() {
            const infoDiv = document.querySelector('.calendar-info h3');
            if (infoDiv && selectedPlan.classes > 0) {
                const remaining = selectedPlan.classes - selectedPlan.bookedClasses;
                infoDiv.innerHTML = `📅 Selecciona tus Clases (${selectedPlan.bookedClasses}/${selectedPlan.classes} seleccionadas, ${remaining} restantes)`;
            }
        }

        // ========== MERCADO PAGO PAYMENT FLOW ==========
        // Todo el flujo de pago está ahora al final del HTML en un solo bloque <script>
        // Incluye: iniciarPagoAura, guardarRegistroLocalYPagar, crearPreferenciaYRedirigir, detectarRetornoDePago
        // ========== FIN MERCADO PAGO PAYMENT FLOW ==========

        let calendarInitRetries = 0;
        const MAX_CALENDAR_INIT_RETRIES = 20;
        
        function initCalendar() {
            console.log('Inicializando FullCalendar v6.1.15...');
            
            // Verificar que FullCalendar esté cargado
            if (typeof FullCalendar === 'undefined') {
                calendarInitRetries++;
                if (calendarInitRetries >= MAX_CALENDAR_INIT_RETRIES) {
                    console.error('❌ ERROR: FullCalendar no se pudo cargar después de varios intentos');
                    return;
                }
                console.warn(`⚠️ FullCalendar no está cargado aún. Intento ${calendarInitRetries}/${MAX_CALENDAR_INIT_RETRIES}...`);
                setTimeout(initCalendar, 500);
                return;
            }
            
            const calendarEl = document.getElementById('calendar');
            
            // DEBUG: Verificar que el elemento exista
            if (!calendarEl) {
                console.error('❌ ERROR: Div #calendar no encontrado en el DOM');
                alert('Error: No se pudo inicializar el calendario. Verifica que el div #calendar exista.');
                return;
            }
            
            try {
                // Initialize FullCalendar v6 with Spanish locale and monthly view
                calendar = new FullCalendar.Calendar(calendarEl, {
                    initialView: 'dayGridMonth', // Vista mensual inicial
                    locale: 'es', // Configurar el calendario en español
                    headerToolbar: {
                        left: 'prev,next today', // Botones de navegación
                        center: 'title',
                        right: '' // Solo vista mensual
                    },
                    dayHeaderFormat: {
                        weekday: 'short'
                    },
                    hiddenDays: [0], // Hide Sunday
                    selectable: false, // Deshabilitamos el drag-to-select
                    nowIndicator: true,
                    height: 'auto',
                    expandRows: true,
                    fixedWeekCount: false,
                    
                    // Al hacer clic en una fecha: mostrar selector de horario
                    dateClick: function(info) {
                        handleDateClick(info);
                    },
                    
                    // Al hacer clic en un evento existente: mostrar detalles o permitir eliminar
                    eventClick: function(info) {
                        handleEventClick(info);
                    },
                    
                    validRange: {
                        start: new Date()
                    },
                    
                    // Los eventos se cargarán dinámicamente desde Firestore
                    events: []
                });
                
                calendar.render();
                
                // Hacer el calendario globalmente accesible
                window.calendar = calendar;
                console.log('✅ FullCalendar v6.1.15 inicializado correctamente y disponible globalmente');
                
                // Cargar eventos desde Firestore
                loadEventsFromFirestore();
                
            } catch (error) {
                console.error('❌ ERROR al inicializar FullCalendar:', error);
                alert('Error al inicializar el calendario. Por favor, recarga la página.');
            }
        }

        /**
         * Cargar eventos desde Firebase Firestore
         * REQUISITO: Si admin, mostrar todos los eventos; si no, clases públicas fijas
         * 
         * - Si el usuario es admin@aura.com: muestra todas las reservas desde Firestore
         * - Si no es admin: muestra solo clases públicas fijas de pilates (recurrentes)
         * 
         * Las reservas se cargan con fechaHora en formato ISO (YYYY-MM-DDTHH:mm:ss)
         */
        async function loadEventsFromFirestore() {
            if (!calendar) {
                console.warn('⚠️ Calendario no inicializado aún');
                return;
            }
            
            console.log('Cargando eventos desde Firestore...');
            
            try {
                // Verificar si Firebase está disponible
                if (typeof window.db === 'undefined') {
                    console.warn('⚠️ Firebase Firestore no está disponible aún. Esperando inicialización...');
                    
                    // Intentar de nuevo después de 1 segundo
                    setTimeout(loadEventsFromFirestore, 1000);
                    return;
                }
                
                // Limpiar eventos existentes
                calendar.getEvents().forEach(event => event.remove());
                
                // Si es admin, cargar todas las reservas desde Firestore
                if (isAdmin) {
                    console.log('Usuario admin: cargando todas las reservas desde Firestore');
                    
                    const { getDocs, collection, query, orderBy } = window.firestoreExports;
                    const q = query(collection(window.db, 'reservas'), orderBy('timestamp', 'desc'));
                    const querySnapshot = await getDocs(q);
                    
                    querySnapshot.forEach((doc) => {
                        const data = doc.data();
                        
                        // Intentar parsear fechaHora para obtener start date
                        // Formato esperado: "lunes, 15 de noviembre de 2025 a las 10:00"
                        let startDate = null;
                        
                        if (data.fechaHora) {
                            // Intentar diferentes formatos
                            startDate = parseFechaHora(data.fechaHora);
                        }
                        
                        // Si no se pudo parsear, usar timestamp como fallback
                        if (!startDate && data.timestamp) {
                            startDate = data.timestamp.toDate();
                        }
                        
                        if (startDate) {
                            calendar.addEvent({
                                id: doc.id,
                                title: data.nombre || 'Reserva',
                                start: startDate,
                                backgroundColor: '#EFE9E1',
                                borderColor: '#EFE9E1',
                                textColor: '#333',
                                extendedProps: {
                                    email: data.email,
                                    notas: data.notas,
                                    firebaseId: doc.id
                                }
                            });
                        }
                    });
                    
                    console.log(`✅ ${querySnapshot.size} reservas cargadas desde Firestore`);
                    
                } else {
                    // Usuario no admin: no mostrar eventos en el calendario público
                    // Solo se muestra el calendario limpio y al hacer clic se abre el selector de horarios
                    console.log('Usuario público: calendario limpio sin eventos');
                    // Usuario no admin: calendario vacío para seleccionar días y horarios disponibles
                    // El flujo correcto es: cliente elige paquete → ve calendario → hace clic en día → aparecen horarios disponibles
                    console.log('Usuario público: calendario vacío para selección de horarios');
                }
                
            } catch (error) {
                console.error('❌ ERROR al cargar eventos desde Firestore:', error);
                console.error('Detalles del error:', error.message);
                
                // Si es un error de permisos, mostrar mensaje específico
                if (error.code === 'permission-denied') {
                    console.error('Error de permisos: verifica las reglas de seguridad de Firestore');
                }
            }
        }

        /**
         * Parsear fechaHora a objeto Date
         * REQUISITO: Formato esperado es ISO (YYYY-MM-DDTHH:mm:ss)
         * 
         * Prioridad de parseo:
         * 1. ISO format (YYYY-MM-DDTHH:mm:ss) - formato requerido y estándar
         * 2. Formato español legacy - compatibilidad con datos antiguos (fallback)
         * 
         * Ejemplos de formato ISO válido:
         * - "2025-11-15T10:00:00"
         * - "2025-12-25T18:30:00"
         */
        function parseFechaHora(fechaHoraStr) {
            try {
                // Validar entrada
                if (!fechaHoraStr || typeof fechaHoraStr !== 'string') {
                    console.warn('⚠️ fechaHora inválido o vacío:', fechaHoraStr);
                    return null;
                }
                
                // Intentar parsear como ISO date primero (formato preferido)
                // Formato: YYYY-MM-DDTHH:mm:ss o YYYY-MM-DDTHH:mm:ss.sssZ
                const isoDate = new Date(fechaHoraStr);
                if (!isNaN(isoDate.getTime())) {
                    console.log('✅ Fecha parseada en formato ISO:', fechaHoraStr, '→', isoDate);
                    return isoDate;
                }
                
                // Fallback: intentar parsear formato español legacy
                // Ejemplo: "lunes, 15 de noviembre de 2025 a las 10:00"
                const regex = /(\d+)\s+de\s+(\w+)\s+de\s+(\d{4})\s+a\s+las\s+(\d{1,2}):(\d{2})/i;
                const match = fechaHoraStr.match(regex);
                
                if (match) {
                    const day = parseInt(match[1]);
                    const monthName = match[2].toLowerCase();
                    const year = parseInt(match[3]);
                    const hour = parseInt(match[4]);
                    const minute = parseInt(match[5]);
                    
                    // Mapear nombres de meses en español a números
                    const months = {
                        'enero': 0, 'febrero': 1, 'marzo': 2, 'abril': 3,
                        'mayo': 4, 'junio': 5, 'julio': 6, 'agosto': 7,
                        'septiembre': 8, 'octubre': 9, 'noviembre': 10, 'diciembre': 11
                    };
                    
                    const month = months[monthName];
                    
                    if (month !== undefined) {
                        const date = new Date(year, month, day, hour, minute);
                        console.log('✅ Fecha parseada en formato español:', fechaHoraStr, '→', date);
                        return date;
                    }
                }
                
                console.error('❌ No se pudo parsear fechaHora:', fechaHoraStr);
                return null;
                
            } catch (error) {
                console.error('❌ Error al parsear fechaHora:', fechaHoraStr, error);
                return null;
            }
        }

        /**
         * Manejar click en una fecha del calendario
         * NUEVO FLUJO: No requiere autenticación previa
         */
        function handleDateClick(info) {
            console.log('Fecha clickeada:', info.dateStr);
            
            const clickedDate = new Date(info.dateStr + 'T00:00:00');
            const day = clickedDate.getDay();
            
            // Check if Sunday
            if (day === 0) {
                alert('❌ No hay clases los domingos');
                return;
            }

            // Check if date is in the past
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            if (clickedDate < today) {
                alert('❌ No puedes seleccionar fechas pasadas');
                return;
            }

            // Check if plan is selected
            if (selectedPlan.classes === 0) {
                alert('⚠️ Por favor, selecciona un plan primero');
                return;
            }

            // Check if limit reached
            if (selectedPlan.bookedClasses >= selectedPlan.classes) {
                alert('✅ Ya has reservado todas las clases de tu plan.\n\nSi deseas cambiar una clase, haz clic en ella para cancelarla.');
                return;
            }

            // Mostrar modal de selección de horario
            showTimeSelectionModal(info.dateStr);
        }

        /**
         * Manejar click en un evento existente
         */
        function handleEventClick(info) {
            const event = info.event;
            const startTime = event.start ? event.start.toLocaleTimeString('es-ES', { 
                hour: '2-digit', 
                minute: '2-digit' 
            }) : '';
            
            let message = `Evento: ${event.title}\nHora: ${startTime}`;
            
            // Si es admin, mostrar más información
            if (isAdmin && event.extendedProps) {
                if (event.extendedProps.email) {
                    message += `\nEmail: ${event.extendedProps.email}`;
                }
                if (event.extendedProps.notas) {
                    message += `\nNotas: ${event.extendedProps.notas}`;
                }
                alert(message);
            } else {
                // Si es un evento temporal del usuario, permitir eliminarlo
                const userEventIndex = selectedPlan.bookedEvents.findIndex(e => e.eventId === event.id);
                if (userEventIndex !== -1) {
                    const confirmDelete = confirm(`${message}\n\n¿Deseas eliminar esta clase reservada?`);
                    if (confirmDelete) {
                        event.remove();
                        selectedPlan.bookedClasses--;
                        selectedPlan.bookedEvents.splice(userEventIndex, 1);
                        // Actualizar localStorage
                        saveTempReservations();
                        updateCalendarInfo();
                    }
                }
                // No mostrar ningún alert para otros eventos (calendario limpio para usuarios públicos)
            }
        }

        /**
         * Contar cuántas reservas existen para una fecha y hora específica
         * @param {string} dateStr - Fecha en formato YYYY-MM-DD
         * @param {string} time - Hora en formato HH:mm
         * @returns {Promise<number>} Número de reservas para ese horario
         */
        async function getReservationCountForTimeSlot(dateStr, time) {
            try {
                // Si Firestore no está disponible, asumir 0 reservas
                if (!window.db) {
                    console.warn('Firestore no disponible, asumiendo 0 reservas');
                    return 0;
                }
                
                const { getDocs, collection, query } = window.firestoreExports;
                const q = query(collection(window.db, 'reservas'));
                const querySnapshot = await getDocs(q);
                
                // Construir el fechaHora objetivo en formato ISO
                const targetDateTime = `${dateStr}T${time}:00`;
                
                // Contar cuántas reservas coinciden con esta fecha y hora
                let count = 0;
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    // Comparar fechaHora en formato ISO
                    if (data.fechaHora === targetDateTime) {
                        count++;
                    }
                });
                
                console.log(`🔍 Cupo para ${targetDateTime}: ${count}/5 personas`);
                return count;
            } catch (error) {
                console.error('Error al contar reservas:', error);
                // En caso de error, asumir 0 para no bloquear reservas
                return 0;
            }
        }

        /**
         * Mostrar modal de selección de horario
         */
        async function showTimeSelectionModal(dateStr) {
            const modal = document.getElementById('time-selection-modal');
            const dateDisplay = document.getElementById('time-modal-date');
            const slotsContainer = document.getElementById('time-slots-container');
            
            // Formatear fecha para mostrar
            const date = new Date(dateStr + 'T00:00:00');
            const dateFormatted = date.toLocaleDateString('es-ES', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            dateDisplay.textContent = dateFormatted;
            
            // Generar horarios disponibles
            slotsContainer.innerHTML = '';
            
            const morningSlots = ['06:00', '07:00', '08:00', '09:00', '10:00'];
            const eveningSlots = ['17:00', '18:00', '19:00'];
            
            // Agregar horarios de mañana
            const morningTitle = document.createElement('div');
            morningTitle.style.cssText = 'grid-column: 1 / -1; padding: 8px; font-weight: 600; color: #EFE9E1; text-align: center; background: rgba(239, 233, 225, 0.1); border-radius: 8px; margin-bottom: 5px;';
            morningTitle.textContent = '🌅 Mañana';
            slotsContainer.appendChild(morningTitle);
            
            // Verificar capacidad para cada horario de mañana
            for (const time of morningSlots) {
                const count = await getReservationCountForTimeSlot(dateStr, time);
                const button = createTimeSlotButton(dateStr, time, count);
                slotsContainer.appendChild(button);
            }
            
            // Agregar horarios de tarde
            const eveningTitle = document.createElement('div');
            eveningTitle.style.cssText = 'grid-column: 1 / -1; padding: 8px; font-weight: 600; color: #EFE9E1; text-align: center; background: rgba(239, 233, 225, 0.1); border-radius: 8px; margin: 10px 0 5px 0;';
            eveningTitle.textContent = '🌆 Tarde';
            slotsContainer.appendChild(eveningTitle);
            
            // Verificar capacidad para cada horario de tarde
            for (const time of eveningSlots) {
                const count = await getReservationCountForTimeSlot(dateStr, time);
                const button = createTimeSlotButton(dateStr, time, count);
                slotsContainer.appendChild(button);
            }
            
            // Mostrar modal
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
        }

        /**
         * Convertir hora de formato 24h a formato 12h con AM/PM
         * @param {string} time - Hora en formato HH:mm (ej: "06:00", "17:00")
         * @returns {string} Hora en formato 12h con AM/PM (ej: "6 AM", "5 PM")
         */
        function formatTimeTo12Hour(time) {
            const [hours, minutes] = time.split(':').map(Number);
            const period = hours >= 12 ? 'PM' : 'AM';
            const hour12 = hours % 12 || 12;
            return `${hour12} ${period}`;
        }

        /**
         * Crear botón de horario
         * @param {string} dateStr - Fecha en formato YYYY-MM-DD
         * @param {string} time - Hora en formato HH:mm
         * @param {number} currentCount - Número actual de reservas para este horario
         */
        function createTimeSlotButton(dateStr, time, currentCount = 0) {
            const MAX_CAPACITY = 5;
            const button = document.createElement('button');
            const isFull = currentCount >= MAX_CAPACITY;
            const time12h = formatTimeTo12Hour(time);
            
            // Mostrar hora y disponibilidad en líneas separadas
            if (isFull) {
                button.innerHTML = `<span style="display: block; font-weight: bold;">${time12h}</span><span style="display: block; font-size: 0.85rem; white-space: nowrap;">(Lleno)</span>`;
                // Estilo gris cuando está lleno
                button.style.cssText = 'padding: 15px; background: #cccccc; color: #666; border: 1px solid #999; font-size: 1rem; cursor: not-allowed; opacity: 0.6; text-align: center;';
                button.disabled = true;
                
                // Mostrar mensaje al intentar hacer clic
                button.addEventListener('click', (e) => {
                    e.preventDefault();
                    alert(`⚠️ Lo sentimos, este horario (${time12h}) ya está completo.\n\nCapacidad máxima: ${MAX_CAPACITY} personas\nDisponibilidad: ${MAX_CAPACITY}/${MAX_CAPACITY}\n\nPor favor, selecciona otro horario disponible.`);
                });
            } else {
                const available = MAX_CAPACITY - currentCount;
                button.innerHTML = `<span style="display: block; font-weight: bold;">${time12h}</span><span style="display: block; font-size: 0.85rem; white-space: nowrap;">(${available} disponibles)</span>`;
                // Estilo normal cuando hay disponibilidad
                button.style.cssText = 'padding: 15px; background: #EFE9E1; color: #fff; border: 1px solid #ccc; font-size: 1rem; cursor: pointer; transition: all 0.3s ease; text-align: center;';
                
                // Efecto hover
                button.addEventListener('mouseenter', () => {
                    button.style.background = '#EFE9E1';
                });
                button.addEventListener('mouseleave', () => {
                    button.style.background = '#EFE9E1';
                });
                
                button.addEventListener('click', () => {
                    selectTimeSlot(dateStr, time);
                });
            }
            
            return button;
        }

        /**
         * Seleccionar horario y mostrar modal de datos + pago
         * NUEVO FLUJO: Pedir nombre y teléfono por cada reserva
         */
        async function selectTimeSlot(dateStr, time) {
            const MAX_CAPACITY = 5;
            
            // Verificar capacidad antes de continuar
            const currentCount = await getReservationCountForTimeSlot(dateStr, time);
            if (currentCount >= MAX_CAPACITY) {
                alert(`⚠️ Lo sentimos, este horario ya está completo.\n\nCapacidad máxima: ${MAX_CAPACITY} personas\nActualmente reservado: ${currentCount}/${MAX_CAPACITY}\n\nPor favor, selecciona otro horario.`);
                return;
            }
            
            // Cerrar modal de selección de horario
            document.getElementById('time-selection-modal').style.display = 'none';
            
            // Crear fecha y hora en formato ISO
            const dateTimeStr = `${dateStr}T${time}:00`;
            const dateTime = new Date(dateTimeStr);
            
            // Format date and time for display in modal
            const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const timeOptions = { hour: '2-digit', minute: '2-digit' };
            const dateFormatted = dateTime.toLocaleDateString('es-ES', dateOptions);
            const timeFormatted = dateTime.toLocaleTimeString('es-ES', timeOptions);
            
            // Mostrar modal de confirmación con datos del cliente
            showReservationModal(dateStr, time, dateFormatted, timeFormatted, dateTimeStr);
        }

        // Constants for phone number handling
        const MEXICO_COUNTRY_CODE = '52';
        const PHONE_DIGITS_LENGTH = 10;
        
        /**
         * Mostrar modal de confirmación de reserva con datos del cliente
         * NUEVO FLUJO: Pedir nombre y teléfono por cada horario
         */
        function showReservationModal(dateStr, time, dateFormatted, timeFormatted, dateTimeStr) {
            const modal = document.getElementById('reservation-modal');
            const dateDisplay = document.getElementById('reservation-date-display');
            const timeDisplay = document.getElementById('reservation-time-display');
            const nameInput = document.getElementById('reservation-name');
            const phoneInput = document.getElementById('reservation-phone');
            const progressDisplay = document.getElementById('reservation-progress');
            const confirmBtn = document.getElementById('reservation-confirm');
            const cancelBtn = document.getElementById('reservation-cancel');
            
            // Mostrar fecha y hora seleccionada
            dateDisplay.textContent = dateFormatted;
            timeDisplay.textContent = timeFormatted;
            
            // Mostrar progreso
            const currentCount = selectedPlan.bookedClasses + 1;
            progressDisplay.textContent = `${currentCount} de ${selectedPlan.classes} clases seleccionadas`;
            
            // Pre-llenar con datos si ya están en localStorage (de pago previo)
            const savedName = localStorage.getItem('userNombre') || '';
            const savedPhone = localStorage.getItem('userTelefono') || '';
            nameInput.value = savedName;
            // Remove country code prefix if present (supports any length country code)
            if (savedPhone.startsWith(MEXICO_COUNTRY_CODE) && savedPhone.length > MEXICO_COUNTRY_CODE.length) {
                phoneInput.value = savedPhone.substring(MEXICO_COUNTRY_CODE.length);
            } else {
                phoneInput.value = savedPhone;
            }
            
            // Event handlers
            confirmBtn.onclick = () => {
                confirmReservation(dateStr, time, dateTimeStr);
            };
            
            cancelBtn.onclick = () => {
                modal.style.display = 'none';
                // Volver a mostrar el modal de selección de horario
                document.getElementById('time-selection-modal').style.display = 'flex';
            };
            
            // Show modal
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
            nameInput.focus();
        }

        /**
         * Confirmar reserva y agregar temporalmente al calendario
         * NUEVO FLUJO: Guardar en localStorage y continuar o proceder al pago
         */
        function confirmReservation(dateStr, time, dateTimeStr) {
            const nameInput = document.getElementById('reservation-name');
            const phoneInput = document.getElementById('reservation-phone');
            
            const nombre = nameInput.value.trim();
            const phoneDigits = phoneInput.value.trim().replace(/\D/g, '');
            
            // Validar campos
            if (!nombre) {
                alert('⚠️ Por favor ingresa tu nombre completo');
                nameInput.focus();
                return;
            }
            
            if (phoneDigits.length !== PHONE_DIGITS_LENGTH) {
                alert(`⚠️ Por favor ingresa ${PHONE_DIGITS_LENGTH} dígitos de teléfono (sin espacios ni guiones)`);
                phoneInput.focus();
                return;
            }
            
            const telefono = MEXICO_COUNTRY_CODE + phoneDigits; // Agregar código de país
            
            // Guardar datos del cliente (se usarán para todas las reservas)
            localStorage.setItem('userNombre', nombre);
            localStorage.setItem('userTelefono', telefono);
            
            // Store in selectedPlan if not already set
            if (!selectedPlan.userInfo) {
                selectedPlan.userInfo = {
                    nombre: nombre,
                    telefono: telefono,
                    notas: ''
                };
            }
            
            // Cerrar modal
            document.getElementById('reservation-modal').style.display = 'none';
            document.body.style.overflow = ''; // Restore scrolling
            
            // Crear fecha y hora en formato ISO
            const dateTime = new Date(dateTimeStr);
            const endDateTime = new Date(dateTime.getTime() + 60 * 60 * 1000); // +1 hora
            
            // Agregar evento al calendario temporalmente
            const eventId = `temp-${Date.now()}`;
            calendar.addEvent({
                id: eventId,
                title: `✓ ${nombre}`,
                start: dateTime,
                end: endDateTime,
                backgroundColor: '#EFE9E1',
                borderColor: '#EFE9E1',
                textColor: '#333',
                extendedProps: {
                    fechaHora: dateTimeStr, // ISO format
                    temporal: true,
                    nombre: nombre,
                    telefono: telefono
                }
            });
            
            // Agregar a la lista de reservas seleccionadas
            selectedPlan.bookedClasses++;
            selectedPlan.bookedEvents.push({
                eventId: eventId,
                fechaHora: dateTimeStr, // ISO format: YYYY-MM-DDTHH:mm:ss
                nombre: nombre,
                telefono: telefono
            });
            
            // Guardar en localStorage (temporal, hasta pago exitoso)
            saveTempReservations();
            
            // Actualizar contador
            updateCalendarInfo();
            
            const remaining = selectedPlan.classes - selectedPlan.bookedClasses;
            
            // Verificar si completó todas las reservas
            if (selectedPlan.bookedClasses >= selectedPlan.classes) {
                // Todas las clases seleccionadas -> proceder al pago
                alert(`✅ ¡Has seleccionado todas tus ${selectedPlan.classes} clases!\n\nAhora serás redirigido al pago...`);
                setTimeout(() => {
                    proceedToPayment();
                }, 1000);
            } else {
                // Continuar seleccionando
                alert(`✅ Clase agregada!\n\n📅 ${dateTime.toLocaleDateString('es-ES', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}\n🕐 ${dateTime.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' })}\n\nClases seleccionadas: ${selectedPlan.bookedClasses}/${selectedPlan.classes}\nClases restantes: ${remaining}\n\nContinúa seleccionando tus clases en el calendario.`);
            }
        }

        /**
         * Guardar reservas temporales en localStorage
         */
        function saveTempReservations() {
            const tempData = {
                reservations: selectedPlan.bookedEvents,
                userInfo: selectedPlan.userInfo
            };
            localStorage.setItem('tempReservations', JSON.stringify(tempData));
            console.log('💾 Reservas temporales guardadas en localStorage');
        }

        /**
         * Proceder al pago con MercadoPago
         */
        async function proceedToPayment() {
            const nombre = selectedPlan.userInfo.nombre;
            const telefono = selectedPlan.userInfo.telefono;
            const classes = selectedPlan.classes;
            const precio = selectedPlan.price;
            
            console.log(`💳 Procesando pago: ${classes} clases x $${precio} para ${nombre}`);
            
            // Crear preferencia de MercadoPago y redirigir
            await crearPreferenciaYRedirigir(nombre, telefono);
        }

        /**
         * Guardar todas las reservas en Firestore
         * Guarda fechaHora en formato ISO (YYYY-MM-DDTHH:mm:ss) como especificado en los requisitos
         * REQUISITO: Solo usuarios autenticados pueden guardar reservas (currentUser no nulo)
         */
        async function saveAllReservations() {
            if (!selectedPlan.userInfo || selectedPlan.bookedEvents.length === 0) {
                alert('❌ No hay reservas para guardar');
                return;
            }
            
            try {
                console.log('🔍 Verificando disponibilidad de Firebase...');
                
                // REQUISITO: Verificar que el usuario esté autenticado
                if (!window.auth || !window.auth.currentUser) {
                    console.error('❌ Usuario no autenticado');
                    alert('❌ Error: Debes iniciar sesión o registrarte para hacer reservas.\n\nPor favor, usa el menú (☰) en la esquina superior derecha para registrarte o iniciar sesión.');
                    return;
                }
                
                console.log('✅ Usuario autenticado:', window.auth.currentUser.email);
                
                // Verificar que Firebase esté disponible
                if (!window.firebaseReady) {
                    console.error('❌ Firebase no está listo');
                    alert('❌ Error: Sistema de reservas no está listo. Por favor, espera unos segundos y vuelve a intentarlo.');
                    return;
                }
                
                if (typeof window.saveReservationToFirestore !== 'function') {
                    console.error('❌ Función saveReservationToFirestore no está disponible');
                    alert('❌ Error: Sistema de reservas no disponible. Por favor, recarga la página.');
                    return;
                }
                
                if (!window.db) {
                    console.error('❌ Firestore DB no está disponible');
                    alert('❌ Error: Base de datos no disponible. Por favor, recarga la página.');
                    return;
                }
                
                const { nombre, telefono, notas } = selectedPlan.userInfo;
                
                console.log(`📝 Guardando ${selectedPlan.bookedEvents.length} reservas para ${nombre}...`);
                
                // Guardar cada reserva en Firestore con fechaHora en formato ISO
                const savedReservations = [];
                const failedReservations = [];
                
                for (let i = 0; i < selectedPlan.bookedEvents.length; i++) {
                    const booking = selectedPlan.bookedEvents[i];
                    try {
                        console.log(`💾 Guardando reserva ${i + 1}/${selectedPlan.bookedEvents.length}...`);
                        
                        // booking.fechaHora ya está en formato ISO (YYYY-MM-DDTHH:mm:ss)
                        const reservaId = await window.saveReservationToFirestore(
                            nombre, 
                            telefono, 
                            booking.fechaHora, // ISO format: YYYY-MM-DDTHH:mm:ss
                            notas
                        );
                        savedReservations.push(reservaId);
                        console.log(`✅ Reserva ${i + 1} guardada con ID:`, reservaId, '- fechaHora:', booking.fechaHora);
                    } catch (reservaError) {
                        console.error(`❌ Error al guardar reserva ${i + 1}:`, reservaError);
                        failedReservations.push({
                            booking,
                            error: reservaError.message
                        });
                    }
                }
                
                // Mostrar resultados
                if (savedReservations.length === selectedPlan.bookedEvents.length) {
                    // Todo se guardó exitosamente
                    alert(`✅ ¡Reservas Completadas y Guardadas!\n\n${savedReservations.length} clases reservadas para ${nombre}\n\nTe contactaremos al ${telefono}`);
                } else if (savedReservations.length > 0) {
                    // Algunas reservas fallaron
                    alert(`⚠️ Reservas Parcialmente Guardadas\n\n${savedReservations.length} de ${selectedPlan.bookedEvents.length} clases guardadas para ${nombre}\n\n${failedReservations.length} reservas fallaron. Por favor, contacta con nosotros para completar tu reserva.`);
                } else {
                    // Todas las reservas fallaron
                    throw new Error('No se pudo guardar ninguna reserva');
                }
                
                // Si el usuario es admin, recargar el panel de admin
                if (isAdmin && typeof window.loadReservationsFromFirestore === 'function') {
                    await window.loadReservationsFromFirestore();
                }
                
                // Recargar eventos del calendario para mostrar las reservas guardadas
                if (calendar) {
                    loadEventsFromFirestore();
                }
                
                // Recargar Mis Clases después de guardar
                const savedTelefono = localStorage.getItem('userTelefono');
                if (window.loadUserClasses && savedTelefono) {
                    window.loadUserClasses(savedTelefono);
                }
                
                // Resetear el plan seleccionado solo si se guardó al menos una reserva
                if (savedReservations.length > 0) {
                    selectedPlan.classes = 0;
                    selectedPlan.price = 0;
                    selectedPlan.bookedClasses = 0;
                    selectedPlan.bookedEvents = [];
                    selectedPlan.userInfo = null;
                    
                    // Ocultar calendario
                    document.getElementById('calendar-container').style.display = 'none';
                }
                
            } catch (error) {
                console.error('❌ Error al guardar las reservas:', error);
                console.error('❌ Detalles completos del error:', {
                    message: error.message,
                    code: error.code,
                    stack: error.stack,
                    firebaseReady: window.firebaseReady,
                    dbAvailable: !!window.db,
                    functionAvailable: typeof window.saveReservationToFirestore === 'function'
                });
                
                // Proporcionar un mensaje de error más específico
                let errorMessage = '❌ Error al guardar las reservas.\n\n';
                
                if (!window.firebaseReady) {
                    errorMessage += 'El sistema aún se está inicializando. Por favor, espera unos segundos y vuelve a intentarlo.\n\n';
                } else if (error.code === 'permission-denied') {
                    errorMessage += 'Error de permisos. Por favor, contacta con el administrador.\n\n';
                } else if (error.code === 'unavailable') {
                    errorMessage += 'Servicio temporalmente no disponible. Por favor, verifica tu conexión a internet.\n\n';
                } else if (error.message) {
                    errorMessage += `Error: ${error.message}\n\n`;
                }
                
                errorMessage += 'Si el problema persiste, por favor contacta con nosotros.';
                
                alert(errorMessage);
            }
        }
    </script>

    <!-- Firebase SDK v10 via CDN -->
    <script type="module">
        /*
         * ========== FIREBASE CONFIGURATION ==========
         * 
         * INSTRUCCIONES PARA CONFIGURAR FIREBASE:
         * 
         * 1. Crear proyecto Firebase:
         *    - Ve a https://console.firebase.google.com/
         *    - Haz clic en "Agregar proyecto"
         *    - Nombre del proyecto: "AURA Studio" (o el que prefieras)
         *    - Sigue los pasos para completar la creación
         * 
         * 2. Habilitar Authentication:
         *    - En el menú lateral, ve a "Authentication" > "Get started"
         *    - En la pestaña "Sign-in method", habilita "Correo electrónico/contraseña"
         *    - Guarda los cambios
         * 
         * 3. Crear usuario administrador:
         *    - En Authentication, ve a la pestaña "Users"
         *    - Haz clic en "Add user"
         *    - Email: admin@aura.com
         *    - Contraseña: admin123
         *    - Haz clic en "Add user"
         * 
         * 4. Habilitar Firestore:
         *    - En el menú lateral, ve a "Firestore Database" > "Create database"
         *    - Elige "Start in test mode" (temporalmente para pruebas)
         *    - Selecciona la ubicación más cercana
         *    - Haz clic en "Enable"
         * 
         * 5. Configurar reglas de seguridad de Firestore:
         *    - En Firestore, ve a la pestaña "Rules"
         *    - Reemplaza las reglas existentes con:
         * 
         *    rules_version = '2';
         *    service cloud.firestore {
         *      match /databases/{database}/documents {
         *        // Colección de reservas: lectura solo para admin, escritura pública
         *        match /reservas/{document=**} {
         *          allow read: if request.auth != null && request.auth.token.email == 'admin@aura.com';
         *          allow write: if true;
         *        }
         *      }
         *    }
         * 
         *    - Haz clic en "Publish"
         * 
         * 6. Obtener configuración de Firebase:
         *    - Ve a la configuración del proyecto (ícono de engranaje junto a "Project Overview")
         *    - En "Your apps", selecciona "Web" (</>) 
         *    - Registra la app con un nombre (ej: "AURA Web")
         *    - Copia el objeto "firebaseConfig"
         *    - Reemplaza el objeto firebaseConfig de abajo con tus valores
         * 
         * 7. Desplegar en GitHub Pages:
         *    - Asegúrate de que el archivo index.html esté en la rama main
         *    - Ve a Settings > Pages en tu repositorio
         *    - Selecciona la rama main y carpeta root
         *    - Guarda y espera a que se despliegue
         */

        // ========== IMPORTAR FIREBASE SDK v10 ==========
        // Importar Firebase con manejo de errores para debugging
        console.log('Importando Firebase SDK v10...');
        
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAnalytics } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, query, where, orderBy, getDocs, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        console.log('✅ Firebase SDK v10 importado correctamente');

        // ========== CONFIGURACIÓN DE FIREBASE ==========
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyAi-MTJrl1I9RIexZQ9xYtN_pr1HdVvkbo",
            authDomain: "aura-studio-2751b.firebaseapp.com",
            projectId: "aura-studio-2751b",
            storageBucket: "aura-studio-2751b.firebasestorage.app",
            messagingSenderId: "869187232401",
            appId: "1:869187232401:web:03e68b9502abe41c651530",
            measurementId: "G-NE444Q9W5F"
        };

        // ========== INICIALIZAR FIREBASE ==========
        let app, auth, db, analytics;
        try {
            console.log('Inicializando Firebase con configuración...');
            
            // Initialize Firebase
            app = initializeApp(firebaseConfig);
            analytics = getAnalytics(app);
            auth = getAuth(app);
            db = getFirestore(app);
            
            // Exponer variables globalmente para acceso desde otros scripts
            window.db = db;
            window.auth = auth;
            
            // Exponer funciones de Firestore para el calendario
            window.firestoreExports = {
                collection,
                addDoc,
                query,
                where,
                orderBy,
                getDocs,
                serverTimestamp
            };
            
            console.log('✅ Firebase inicializado correctamente');
            console.log('✅ Firestore DB disponible globalmente');
            
            // Set a flag to indicate Firebase is ready
            window.firebaseReady = true;
            console.log('✅ Firebase está listo para guardar reservas (window.firebaseReady = true)');
            
        } catch (error) {
            console.error('❌ Error al inicializar Firebase:', error);
            console.error('Detalles:', error.message);
            alert('Error al conectar con Firebase. Por favor, recarga la página o contacta al administrador.');
            window.firebaseReady = false;
        }

        // ========== VARIABLES GLOBALES ==========
        let currentUser = null;

        /**
         * Manejar el envío del formulario de login de administrador
         */
        function setupAdminLogin() {
            const loginForm = document.getElementById('admin-login-form');
            const loginError = document.getElementById('login-error');

            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const email = document.getElementById('admin-email').value;
                const password = document.getElementById('admin-password').value;
                
                // Ocultar error previo
                loginError.style.display = 'none';
                
                try {
                    // Autenticar con Firebase
                    const userCredential = await signInWithEmailAndPassword(auth, email, password);
                    
                    // Verificar que sea el usuario admin
                    if (userCredential.user.email !== 'admin@aura.com') {
                        await signOut(auth);
                        throw new Error('Acceso denegado. Solo el administrador puede acceder.');
                    }
                    
                    console.log('Login exitoso:', userCredential.user.email);
                    
                } catch (error) {
                    console.error('Error de autenticación:', error);
                    
                    // Mostrar mensaje de error
                    let errorMessage = 'Credenciales incorrectas. Por favor, verifica tu email y contraseña.';
                    
                    if (error.code === 'auth/user-not-found') {
                        errorMessage = 'Usuario no encontrado. Por favor, verifica tu email.';
                    } else if (error.code === 'auth/wrong-password') {
                        errorMessage = 'Contraseña incorrecta. Por favor, inténtalo de nuevo.';
                    } else if (error.code === 'auth/invalid-email') {
                        errorMessage = 'Email inválido. Por favor, ingresa un email válido.';
                    } else if (error.message) {
                        errorMessage = error.message;
                    }
                    
                    loginError.textContent = errorMessage;
                    loginError.style.display = 'block';
                }
            });
        }

        /**
         * Configurar el botón de cerrar sesión
         * SISTEMA SUPER SIMPLE: Borrar teléfono y nombre de localStorage
         */
        function setupLogout() {
            // Botón de logout en el menú hamburguesa (usuarios regulares)
            const menuLogoutBtn = document.getElementById('menu-logout');
            
            menuLogoutBtn.addEventListener('click', () => {
                // Borrar teléfono y nombre de localStorage
                localStorage.removeItem('userTelefono');
                localStorage.removeItem('userNombre');
                currentUser = null;
                
                console.log('Sesión cerrada correctamente');
                
                // Ocultar sección "Mis Clases"
                hideUserClasses();
                
                // Actualizar UI
                updateUIForLoggedOutUser();
                
                // Cerrar el menú
                document.getElementById('menu-dropdown').style.display = 'none';
                document.getElementById('hamburger-btn').setAttribute('aria-expanded', 'false');
                document.getElementById('menu-dropdown').setAttribute('aria-hidden', 'true');
            });
            
            // Botón de logout admin en el menú hamburguesa
            const menuAdminLogoutBtn = document.getElementById('menu-admin-logout');
            if (menuAdminLogoutBtn) {
                menuAdminLogoutBtn.addEventListener('click', async () => {
                    try {
                        await signOut(auth);
                        console.log('Sesión de admin cerrada correctamente');
                        
                        // Cerrar el menú
                        document.getElementById('menu-dropdown').style.display = 'none';
                        document.getElementById('hamburger-btn').setAttribute('aria-expanded', 'false');
                        document.getElementById('menu-dropdown').setAttribute('aria-hidden', 'true');
                    } catch (error) {
                        console.error('Error al cerrar sesión:', error);
                        alert('Error al cerrar sesión. Por favor, inténtalo de nuevo.');
                    }
                });
            }
            
            // Botón de logout en el panel de admin (si existe)
            const adminLogoutBtn = document.getElementById('admin-logout-btn');
            if (adminLogoutBtn) {
                adminLogoutBtn.addEventListener('click', async () => {
                    try {
                        await signOut(auth);
                        console.log('Sesión cerrada correctamente');
                    } catch (error) {
                        console.error('Error al cerrar sesión:', error);
                        alert('Error al cerrar sesión. Por favor, inténtalo de nuevo.');
                    }
                });
            }
        }

        /**
         * Actualizar UI para usuario logueado
         */
        function updateUIForLoggedInUser() {
            const menuLogout = document.getElementById('menu-logout');
            const menuRegister = document.getElementById('menu-register');
            
            // Mostrar botón de logout
            menuLogout.style.display = 'block';
            
            // Ocultar opciones de registro
            if (menuRegister) menuRegister.style.display = 'none';
        }
        
        /**
         * Actualizar UI para usuario no logueado
         */
        function updateUIForLoggedOutUser() {
            const menuLogout = document.getElementById('menu-logout');
            const menuRegister = document.getElementById('menu-register');
            
            // Ocultar botón de logout
            menuLogout.style.display = 'none';
            
            // Mostrar opciones de registro
            if (menuRegister) menuRegister.style.display = 'block';
        }
        
        /**
         * Observar cambios en el estado de autenticación
         * SISTEMA SUPER SIMPLE: Verificar localStorage al cargar la página
         */
        function setupAuthObserver() {
            // Verificar si hay un teléfono guardado en localStorage
            const savedTelefono = localStorage.getItem('userTelefono');
            const savedNombre = localStorage.getItem('userNombre');
            if (savedTelefono) {
                console.log('Usuario ya logueado con teléfono:', savedTelefono, 'nombre:', savedNombre);
                currentUser = { telefono: savedTelefono, nombre: savedNombre || '' };
                updateUIForLoggedInUser();
                loadUserClasses(savedTelefono);
            } else {
                console.log('No hay usuario logueado');
                currentUser = null;
                updateUIForLoggedOutUser();
                hideUserClasses();
            }
            
            // Mantener la autenticación de Firebase para admin
            onAuthStateChanged(auth, async (user) => {
                const adminLoginModal = document.getElementById('admin-login-modal');
                const adminPanel = document.getElementById('admin-panel-section');
                const loginForm = document.getElementById('admin-login-form');
                const loginError = document.getElementById('login-error');
                const menuAdminLogin = document.getElementById('menu-admin-login');
                const menuAdminLogout = document.getElementById('menu-admin-logout');
                
                if (user) {
                    // Si es admin, mostrar panel y cerrar modal
                    if (user.email === 'admin@aura.com') {
                        // Establecer flag de admin globalmente para el calendario
                        window.isAdmin = true;
                        isAdmin = true;
                        
                        adminLoginModal.style.display = 'none';
                        adminPanel.style.display = 'block';
                        
                        // Mostrar nombre del admin
                        document.getElementById('admin-email-display').textContent = 'Michel';
                        
                        // Limpiar formulario de login
                        loginForm.reset();
                        loginError.style.display = 'none';
                        
                        // Cargar reservas (que inicializa el calendario automáticamente)
                        await loadReservations();
                        
                        // Recargar eventos del calendario si está inicializado
                        if (typeof calendar !== 'undefined' && calendar) {
                            console.log('Recargando eventos del calendario como admin...');
                            loadEventsFromFirestore();
                        }
                        
                        // Scroll al panel de admin
                        setTimeout(() => {
                            adminPanel.scrollIntoView({ behavior: 'smooth' });
                        }, 300);
                        
                        // Ocultar login de admin y mostrar logout de admin en el menú
                        if (menuAdminLogin) menuAdminLogin.style.display = 'none';
                        if (menuAdminLogout) menuAdminLogout.style.display = 'block';
                    }
                } else {
                    // No hay admin autenticado
                    window.isAdmin = false;
                    isAdmin = false;
                    
                    // Ocultar panel de admin
                    adminPanel.style.display = 'none';
                    
                    // Mostrar login de admin y ocultar logout de admin en el menú
                    if (menuAdminLogin) menuAdminLogin.style.display = 'block';
                    if (menuAdminLogout) menuAdminLogout.style.display = 'none';
                    
                    // Recargar eventos del calendario como usuario no autenticado
                    if (typeof calendar !== 'undefined' && calendar) {
                        console.log('Recargando eventos del calendario sin autenticación...');
                        loadEventsFromFirestore();
                    }
                }
            });
        }

        // ========== FUNCIONES DE FIRESTORE ==========

        /**
         * Guardar reserva en Firestore
         * @param {string} nombre - Nombre del cliente
         * @param {string} telefono - Teléfono del cliente (nuevo sistema)
         * @param {string} fechaHora - Fecha y hora en formato ISO (YYYY-MM-DDTHH:mm:ss)
         * @param {string} notas - Notas adicionales (opcional)
         * @returns {Promise<string>} ID del documento creado
         */
        async function saveReservation(nombre, telefono, fechaHora, notas = '') {
            try {
                console.log('💾 Intentando guardar reserva:', { nombre, telefono, fechaHora, notas });
                
                // Validar que Firebase esté inicializado
                if (!db) {
                    throw new Error('❌ Firebase Firestore no está inicializado. Por favor, recarga la página.');
                }
                
                // Validar que fechaHora esté en formato ISO
                const dateTest = new Date(fechaHora);
                if (isNaN(dateTest.getTime())) {
                    throw new Error('❌ Formato de fecha inválido. Se requiere formato ISO (YYYY-MM-DDTHH:mm:ss)');
                }
                
                // Validar datos requeridos
                if (!nombre || !telefono) {
                    throw new Error('❌ Nombre y teléfono son requeridos');
                }
                
                const docRef = await addDoc(collection(db, 'reservas'), {
                    nombre: nombre,
                    telefono: telefono.trim(),
                    fechaHora: fechaHora, // Formato ISO: YYYY-MM-DDTHH:mm:ss
                    notas: notas || '',
                    timestamp: serverTimestamp()
                });
                
                console.log('✅ Reserva guardada con ID:', docRef.id, '- fechaHora (ISO):', fechaHora);
                return docRef.id;
                
            } catch (error) {
                console.error('❌ Error al guardar reserva:', error);
                console.error('❌ Detalles del error:', {
                    code: error.code,
                    message: error.message,
                    stack: error.stack
                });
                throw error;
            }
        }
        
        // Exponer función globalmente inmediatamente después de definirla
        // Esto asegura que esté disponible antes de que el usuario intente usarla
        window.saveReservationToFirestore = saveReservation;
        console.log('✅ Función saveReservationToFirestore expuesta globalmente');

        /**
         * Obtener perfil del usuario desde Firestore
         * @param {string} email - Email del usuario
         * @returns {Promise<Object|null>} Perfil del usuario o null si no existe
         */
        async function getUserProfile(email) {
            try {
                const emailLower = email.toLowerCase().trim();
                console.log('🔍 Buscando perfil de usuario para:', emailLower);
                
                const q = query(collection(db, 'usuarios'), where('email', '==', emailLower));
                const querySnapshot = await getDocs(q);
                
                if (!querySnapshot.empty) {
                    // Si hay múltiples perfiles (duplicados), usar el primero
                    if (querySnapshot.docs.length > 1) {
                        console.warn(`⚠️ Se encontraron ${querySnapshot.docs.length} perfiles para ${emailLower}. Usando el primero.`);
                    }
                    const userDoc = querySnapshot.docs[0];
                    const userData = userDoc.data();
                    console.log('✅ Perfil encontrado:', userData.nombre);
                    return userData;
                } else {
                    console.log('ℹ️ No se encontró perfil para:', emailLower);
                }
                return null;
            } catch (error) {
                console.error('❌ Error al obtener perfil de usuario:', error);
                console.error('Detalles del error:', error.message);
                return null;
            }
        }
        
        // Exponer función globalmente
        window.getUserProfile = getUserProfile;

        /**
         * Cargar todas las reservas desde Firestore
         * Carga directamente en el calendario de administrador
         */
        async function loadReservations() {
            const loadingDiv = document.getElementById('reservations-loading');
            const noReservationsDiv = document.getElementById('no-reservations');
            
            // Mostrar loading
            loadingDiv.style.display = 'block';
            noReservationsDiv.style.display = 'none';
            
            try {
                // Consultar todas las reservas ordenadas por timestamp descendente
                const q = query(collection(db, 'reservas'), orderBy('timestamp', 'desc'));
                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) {
                    // No hay reservas
                    loadingDiv.style.display = 'none';
                    noReservationsDiv.style.display = 'block';
                } else {
                    // Hay reservas, cargar en el calendario
                    loadingDiv.style.display = 'none';
                    
                    // Inicializar y cargar el calendario de admin
                    if (!window.adminCalendar) {
                        initAdminCalendar();
                    } else {
                        await loadAdminCalendarReservations();
                    }
                }
                
            } catch (error) {
                console.error('Error al cargar reservas:', error);
                loadingDiv.innerHTML = '<p style="color: #EFE9E1;">Error al cargar reservas. Por favor, recarga la página.</p>';
            }
        }

        /**
         * Extraer el primer nombre de un nombre completo
         * Ejemplo: "Ketzy Gallegos" -> "Ketzy"
         */
        function extractFirstName(fullName) {
            if (!fullName || typeof fullName !== 'string') {
                return '';
            }
            const trimmed = fullName.trim();
            const parts = trimmed.split(/\s+/);
            return parts[0] || trimmed;
        }

        /**
         * Inicializar calendario del panel de administrador
         */
        let adminCalendar = null;
        
        function initAdminCalendar() {
            console.log('Inicializando calendario de administrador...');
            
            const calendarEl = document.getElementById('admin-calendar');
            
            if (!calendarEl) {
                console.error('❌ ERROR: Div #admin-calendar no encontrado');
                return;
            }
            
            try {
                // Detect if mobile device (max-width: 768px)
                const isMobile = window.innerWidth <= 768;
                const initialView = isMobile ? 'timeGridDay' : 'timeGridWeek';
                
                console.log(`📱 Dispositivo: ${isMobile ? 'Móvil' : 'Escritorio'} - Vista inicial: ${initialView}`);
                
                adminCalendar = new FullCalendar.Calendar(calendarEl, {
                    initialView: initialView,
                    locale: 'es',
                    headerToolbar: {
                        left: 'prev,next today',
                        center: 'title',
                        right: 'dayGridMonth,timeGridWeek,timeGridDay'
                    },
                    slotMinTime: '06:00:00',
                    slotMaxTime: '20:00:00',
                    allDaySlot: false,
                    expandRows: true,
                    contentHeight: 'auto',
                    height: 'auto',
                    nowIndicator: true,
                    slotDuration: '00:30:00',
                    slotLabelInterval: '01:00',
                    editable: false,
                    selectable: false,
                    
                    // Enhanced visual configuration
                    buttonText: {
                        today: 'Hoy',
                        month: 'Mes',
                        week: 'Semana',
                        day: 'Día'
                    },
                    
                    // Custom day header format - show only first letter (L M M J V S D)
                    dayHeaderFormat: { weekday: 'narrow' },
                    
                    eventClick: function(info) {
                        showEventDetailModal(info.event);
                    },
                    
                    eventDidMount: function(info) {
                        // Add icon to event title
                        const title = info.el.querySelector('.fc-event-title');
                        if (title && !title.querySelector('.event-icon')) {
                            const icon = document.createElement('span');
                            icon.className = 'event-icon';
                            icon.textContent = '👤 ';
                            title.prepend(icon);
                        }
                    },
                    
                    events: []
                });
                
                adminCalendar.render();
                console.log('✅ Calendario de administrador inicializado');
                
                // Show calendar view and controls
                document.getElementById('admin-calendar-view').style.display = 'block';
                document.getElementById('admin-calendar-controls').style.display = 'block';
                document.getElementById('admin-stats-section').style.display = 'block';
                
                // Setup calendar controls
                setupAdminCalendarControls();
                
                // Cargar reservas
                loadAdminCalendarReservations();
                
            } catch (error) {
                console.error('❌ ERROR al inicializar calendario de admin:', error);
            }
        }

        /**
         * Cargar reservas en el calendario de administrador
         */
        let allReservationsData = []; // Store all reservations for filtering
        
        async function loadAdminCalendarReservations() {
            if (!adminCalendar) {
                console.warn('⚠️ Calendario de admin no inicializado');
                return;
            }
            
            console.log('Cargando reservas en calendario de admin...');
            
            try {
                // Limpiar eventos existentes
                adminCalendar.getEvents().forEach(event => event.remove());
                allReservationsData = [];
                
                const q = query(collection(db, 'reservas'), orderBy('timestamp', 'desc'));
                const querySnapshot = await getDocs(q);
                
                // First, collect all reservations
                const reservations = [];
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    
                    // Parsear fechaHora
                    let startDate = null;
                    if (data.fechaHora) {
                        startDate = parseFechaHora(data.fechaHora);
                    }
                    
                    if (!startDate && data.timestamp) {
                        startDate = data.timestamp.toDate();
                    }
                    
                    if (startDate) {
                        // Extraer solo el primer nombre
                        const firstName = extractFirstName(data.nombre);
                        
                        // Calcular hora de fin (1 hora después)
                        const endDate = new Date(startDate.getTime() + 60 * 60 * 1000);
                        
                        reservations.push({
                            id: doc.id,
                            firstName: firstName || 'Reserva',
                            start: startDate,
                            end: endDate,
                            fullName: data.nombre,
                            telefono: data.telefono || data.email, // Soportar ambos por compatibilidad
                            notas: data.notas,
                            firebaseId: doc.id
                        });
                    }
                });
                
                // Group reservations by date and time slot
                const groupedReservations = new Map();
                
                reservations.forEach((reservation) => {
                    // Create a key based on start time (year-month-day-hour-minute)
                    const key = `${reservation.start.getFullYear()}-${reservation.start.getMonth()}-${reservation.start.getDate()}-${reservation.start.getHours()}-${reservation.start.getMinutes()}`;
                    
                    if (!groupedReservations.has(key)) {
                        groupedReservations.set(key, []);
                    }
                    groupedReservations.get(key).push(reservation);
                });
                
                // Create calendar events from grouped reservations
                groupedReservations.forEach((group, key) => {
                    const firstReservation = group[0];
                    
                    let eventData;
                    if (group.length === 1) {
                        // Single reservation - keep existing format
                        eventData = {
                            id: firstReservation.id,
                            title: firstReservation.firstName,
                            start: firstReservation.start,
                            end: firstReservation.end,
                            backgroundColor: '#EFE9E1',
                            borderColor: '#EFE9E1',
                            textColor: '#333',
                            extendedProps: {
                                fullName: firstReservation.fullName,
                                telefono: firstReservation.telefono,
                                notas: firstReservation.notas,
                                firebaseId: firstReservation.firebaseId,
                                isGrouped: false
                            }
                        };
                    } else {
                        // Multiple reservations at same time - create grouped event
                        eventData = {
                            id: key,
                            title: `${group.length} Personas`,
                            start: firstReservation.start,
                            end: firstReservation.end,
                            backgroundColor: '#EFE9E1',
                            borderColor: '#EFE9E1',
                            textColor: '#333',
                            extendedProps: {
                                isGrouped: true,
                                count: group.length,
                                participants: group.map(r => ({
                                    fullName: r.fullName,
                                    telefono: r.telefono,
                                    notas: r.notas,
                                    firebaseId: r.firebaseId
                                }))
                            }
                        };
                    }
                    
                    // Store for filtering
                    allReservationsData.push(eventData);
                    
                    // Add to calendar
                    adminCalendar.addEvent(eventData);
                });
                
                console.log(`✅ ${querySnapshot.size} reservas cargadas en calendario de admin (${groupedReservations.size} eventos)`);
                
                // Update statistics
                updateAdminStatistics();
                
            } catch (error) {
                console.error('❌ Error al cargar reservas en calendario de admin:', error);
            }
        }
        
        /**
         * Update admin statistics
         */
        function updateAdminStatistics() {
            if (!allReservationsData || allReservationsData.length === 0) {
                return;
            }
            
            const now = new Date();
            const startOfWeek = new Date(now);
            startOfWeek.setDate(now.getDate() - now.getDay() + 1); // Monday
            startOfWeek.setHours(0, 0, 0, 0);
            
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6); // Sunday
            endOfWeek.setHours(23, 59, 59, 999);
            
            // Count total reservations (including grouped participants)
            let totalReservations = 0;
            let thisWeekCount = 0;
            let upcomingCount = 0;
            const uniqueEmails = new Set();
            
            allReservationsData.forEach(event => {
                const eventDate = new Date(event.start);
                
                if (event.extendedProps.isGrouped && event.extendedProps.participants) {
                    // Count each participant in grouped events
                    const participantCount = event.extendedProps.participants.length;
                    totalReservations += participantCount;
                    
                    // Count this week
                    if (eventDate >= startOfWeek && eventDate <= endOfWeek) {
                        thisWeekCount += participantCount;
                    }
                    
                    // Count upcoming
                    if (eventDate >= now) {
                        upcomingCount += participantCount;
                    }
                    
                    // Add unique telefonos
                    event.extendedProps.participants.forEach(p => {
                        if (p.telefono) uniqueEmails.add(p.telefono);
                    });
                } else {
                    // Single reservation
                    totalReservations += 1;
                    
                    if (eventDate >= startOfWeek && eventDate <= endOfWeek) {
                        thisWeekCount += 1;
                    }
                    
                    if (eventDate >= now) {
                        upcomingCount += 1;
                    }
                    
                    if (event.extendedProps.telefono) {
                        uniqueEmails.add(event.extendedProps.telefono);
                    }
                }
            });
            
            // Update UI
            document.getElementById('stat-total-reservations').textContent = totalReservations;
            document.getElementById('stat-this-week').textContent = thisWeekCount;
            document.getElementById('stat-unique-clients').textContent = uniqueEmails.size;
            document.getElementById('stat-upcoming').textContent = upcomingCount;
        }
        
        /**
         * Setup admin calendar controls
         */
        function setupAdminCalendarControls() {
            // Search by client
            const searchInput = document.getElementById('search-client');
            let searchTimeout;
            searchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    applyFilters();
                }, 300);
            });
            
            // Filter buttons
            document.getElementById('btn-filter-apply').addEventListener('click', applyFilters);
            document.getElementById('btn-filter-clear').addEventListener('click', clearFilters);
            document.getElementById('btn-refresh-calendar').addEventListener('click', () => {
                loadAdminCalendarReservations();
            });
            document.getElementById('btn-export-calendar').addEventListener('click', exportCalendarData);
            
            // Event detail modal controls
            document.getElementById('event-detail-close').addEventListener('click', closeEventDetailModal);
            document.getElementById('detail-close-btn').addEventListener('click', closeEventDetailModal);
            document.getElementById('detail-contact-btn').addEventListener('click', contactClient);
            
            // Close modal on background click
            document.getElementById('event-detail-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeEventDetailModal();
                }
            });
        }
        
        /**
         * Apply filters to calendar
         */
        function applyFilters() {
            if (!adminCalendar || !allReservationsData) return;
            
            const searchText = document.getElementById('search-client').value.toLowerCase();
            const dateStart = document.getElementById('filter-date-start').value;
            const dateEnd = document.getElementById('filter-date-end').value;
            
            // Clear current events
            adminCalendar.getEvents().forEach(event => event.remove());
            
            // Filter and re-add events
            const filteredEvents = allReservationsData.filter(event => {
                // Search filter
                if (searchText) {
                    let matchFound = false;
                    
                    // Check if grouped event
                    if (event.extendedProps.isGrouped && event.extendedProps.participants) {
                        // Search in all participants
                        matchFound = event.extendedProps.participants.some(participant => {
                            const fullName = (participant.fullName || '').toLowerCase();
                            const telefono = (participant.telefono || '').toLowerCase();
                            return fullName.includes(searchText) || telefono.includes(searchText);
                        });
                    } else {
                        // Single event search
                        const fullName = (event.extendedProps.fullName || '').toLowerCase();
                        const telefono = (event.extendedProps.telefono || '').toLowerCase();
                        matchFound = fullName.includes(searchText) || telefono.includes(searchText);
                    }
                    
                    if (!matchFound) {
                        return false;
                    }
                }
                
                // Date range filter
                if (dateStart) {
                    const startFilter = new Date(dateStart);
                    startFilter.setHours(0, 0, 0, 0);
                    if (event.start < startFilter) {
                        return false;
                    }
                }
                
                if (dateEnd) {
                    const endFilter = new Date(dateEnd);
                    endFilter.setHours(23, 59, 59, 999);
                    if (event.start > endFilter) {
                        return false;
                    }
                }
                
                return true;
            });
            
            // Add filtered events
            filteredEvents.forEach(event => {
                adminCalendar.addEvent(event);
            });
            
            console.log(`🔍 Filtro aplicado: ${filteredEvents.length} de ${allReservationsData.length} eventos`);
        }
        
        /**
         * Clear all filters
         */
        function clearFilters() {
            document.getElementById('search-client').value = '';
            document.getElementById('filter-date-start').value = '';
            document.getElementById('filter-date-end').value = '';
            applyFilters();
        }
        
        /**
         * Export calendar data to CSV
         */
        function exportCalendarData() {
            if (!allReservationsData || allReservationsData.length === 0) {
                alert('⚠️ No hay datos para exportar');
                return;
            }
            
            // Create CSV content
            let csv = 'Cliente,Teléfono,Fecha,Hora,Notas\n';
            
            allReservationsData.forEach(event => {
                const date = event.start.toLocaleDateString('es-ES');
                const time = event.start.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
                
                // Check if grouped event
                if (event.extendedProps.isGrouped && event.extendedProps.participants) {
                    // Export each participant as a separate row
                    event.extendedProps.participants.forEach(participant => {
                        const fullName = participant.fullName || '';
                        const telefono = participant.telefono || '';
                        const notes = (participant.notas || '').replace(/,/g, ';');
                        csv += `"${fullName}","${telefono}","${date}","${time}","${notes}"\n`;
                    });
                } else {
                    // Single reservation
                    const fullName = event.extendedProps.fullName || '';
                    const telefono = event.extendedProps.telefono || '';
                    const notes = (event.extendedProps.notas || '').replace(/,/g, ';');
                    csv += `"${fullName}","${telefono}","${date}","${time}","${notes}"\n`;
                }
            });
            
            // Download CSV
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            const filename = `reservas_aura_${new Date().toISOString().split('T')[0]}.csv`;
            
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            console.log(`✅ Datos exportados: ${filename}`);
        }
        
        /**
         * Show event detail modal
         */
        function showEventDetailModal(event) {
            const props = event.extendedProps;
            
            // Format date and time (common for both single and grouped)
            const date = event.start.toLocaleDateString('es-ES', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            document.getElementById('detail-date').textContent = date;
            
            const startTime = event.start.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
            const endTime = event.end ? event.end.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' }) : '';
            document.getElementById('detail-time').textContent = endTime ? `${startTime} - ${endTime}` : startTime;
            
            // Check if this is a grouped event
            if (props.isGrouped && props.participants && props.participants.length > 0) {
                // Handle grouped event - show all participants
                const modalHeader = document.querySelector('.event-detail-header h3');
                modalHeader.textContent = `👥 Detalle de Reserva - ${props.count} Personas`;
                
                // Create participant list HTML
                let participantsHTML = '<div class="participants-list">';
                props.participants.forEach((participant, index) => {
                    participantsHTML += `
                        <div class="participant-item" style="padding: 10px; margin-bottom: 10px; border-left: 3px solid #EFE9E1; background-color: #EFE9E1; border-radius: 5px;">
                            <div style="font-weight: 600; color: #333; margin-bottom: 5px;">
                                <span style="color: #EFE9E1; margin-right: 5px;">👤</span>${participant.fullName || '-'}
                            </div>
                            <div style="font-size: 14px; color: #666; margin-bottom: 3px;">
                                <span style="color: #EFE9E1; margin-right: 5px;">📱</span>${participant.telefono || '-'}
                            </div>
                            ${participant.notas && participant.notas.trim() ? `
                                <div style="font-size: 13px; color: #777; font-style: italic;">
                                    <span style="color: #EFE9E1; margin-right: 5px;">📝</span>${participant.notas}
                                </div>
                            ` : ''}
                        </div>
                    `;
                });
                participantsHTML += '</div>';
                
                // Replace client name/email section with participants list
                document.getElementById('detail-client-name').innerHTML = participantsHTML;
                document.getElementById('detail-client-email').style.display = 'none';
                document.querySelector('.event-detail-row:has(#detail-client-email)').style.display = 'none';
                
                // Hide single client row, show only participants
                const clientRow = document.querySelector('.event-detail-row:has(#detail-client-name)');
                clientRow.querySelector('.event-detail-icon').style.display = 'none';
                clientRow.querySelector('.event-detail-label').textContent = 'Participantes';
                
                // Hide notes row for grouped events (notes shown per participant)
                document.getElementById('detail-notes-row').style.display = 'none';
                
                // Hide contact button for grouped events (multiple emails)
                document.getElementById('detail-contact-btn').style.display = 'none';
                window.currentEventEmail = null;
            } else {
                // Handle single event - show one client
                const modalHeader = document.querySelector('.event-detail-header h3');
                modalHeader.textContent = '👤 Detalle de Reserva';
                
                // Show client name and telefono normally
                document.getElementById('detail-client-name').textContent = props.fullName || event.title;
                document.getElementById('detail-client-email').textContent = props.telefono || '-';
                document.getElementById('detail-client-email').style.display = 'block';
                document.querySelector('.event-detail-row:has(#detail-client-email)').style.display = 'flex';
                
                // Restore client row styling
                const clientRow = document.querySelector('.event-detail-row:has(#detail-client-name)');
                clientRow.querySelector('.event-detail-icon').style.display = 'flex';
                clientRow.querySelector('.event-detail-label').textContent = 'Cliente';
                
                // Notes (optional)
                const notesRow = document.getElementById('detail-notes-row');
                if (props.notas && props.notas.trim()) {
                    document.getElementById('detail-notes').textContent = props.notas;
                    notesRow.style.display = 'flex';
                } else {
                    notesRow.style.display = 'none';
                }
                
                // Show contact button and store telefono
                document.getElementById('detail-contact-btn').style.display = 'inline-block';
                window.currentEventTelefono = props.telefono;
            }
            
            // Show modal
            document.getElementById('event-detail-modal').style.display = 'flex';
        }
        
        /**
         * Close event detail modal
         */
        function closeEventDetailModal() {
            document.getElementById('event-detail-modal').style.display = 'none';
        }
        
        /**
         * Contact client via WhatsApp
         */
        function contactClient() {
            const telefono = window.currentEventTelefono;
            if (telefono) {
                const mensaje = encodeURIComponent('Hola! Te contactamos desde AURA Studio respecto a tu reserva. ¿En qué podemos ayudarte?');
                window.open(`https://wa.me/52${telefono}?text=${mensaje}`, '_blank');
            } else {
                alert('⚠️ No hay teléfono disponible para este cliente');
            }
        }

        // ========== MY CLASSES FUNCTIONALITY ==========
        
        /**
         * Load user's classes from Firestore
         * This function loads only the reservations for the currently logged-in user
         * SISTEMA SUPER SIMPLE: Filtrar por teléfono en vez de email
         */
        async function loadUserClasses(userTelefono) {
            const myClassesSection = document.getElementById('my-classes-section');
            const greetingEl = document.getElementById('my-classes-greeting');
            const loadingDiv = document.getElementById('my-classes-loading');
            const emptyDiv = document.getElementById('my-classes-empty');
            const gridDiv = document.getElementById('my-classes-grid');

            myClassesSection.style.display = 'block';
            loadingDiv.style.display = 'block';
            emptyDiv.style.display = 'none';
            gridDiv.innerHTML = '';
            
            // Set greeting with user's name
            const userName = currentUser?.nombre || localStorage.getItem('userNombre') || '';
            if (userName) {
                greetingEl.textContent = `Hola ${userName}`;
            } else {
                greetingEl.textContent = '📚 Mis Clases';
            }

            try {
                console.log(`Cargando clases para teléfono: ${userTelefono}`);

                // Normalize telefono - trim spaces
                const userTelefonoTrimmed = userTelefono.trim();

                // Query Firestore without filtering to avoid permission issues
                const q = query(collection(db, 'reservas'));

                const querySnapshot = await getDocs(q);
                const userReservations = [];

                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    if (data.telefono && data.telefono.trim() === userTelefonoTrimmed) {
                        userReservations.push({ id: doc.id, ...data });
                    }
                });

                console.log(`Encontradas ${userReservations.length} clases`);

                loadingDiv.style.display = 'none';

                if (userReservations.length === 0) {
                    emptyDiv.style.display = 'block';
                } else {
                    displayUserClasses(userReservations);
                }

            } catch (error) {
                console.error('Error al cargar clases del usuario:', error);
                console.error('Detalles del error:', error.message);
                loadingDiv.style.display = 'none';
                
                // Provide more helpful error message based on error type
                let errorMessage = 'Error al cargar tus clases';
                let errorDetails = 'Intenta recargar la página';
                
                if (error.code === 'permission-denied') {
                    errorDetails = 'Verifica tu conexión y vuelve a iniciar sesión';
                } else if (error.message && error.message.includes('index')) {
                    errorDetails = 'Se está configurando la base de datos. Intenta nuevamente en unos minutos.';
                }
                
                gridDiv.innerHTML = `
                    <div style="text-align:center;padding:40px;color:#EFE9E1;grid-column:1/-1">
                        <p style="font-size:1.2rem">${errorMessage}</p>
                        <p style="margin-top:10px;color:#999">${errorDetails}</p>
                    </div>`;
            }
        }
        
        // Expose loadUserClasses to window object for accessibility
        window.loadUserClasses = loadUserClasses;
        
        /**
         * Display user's classes in the grid
         */
        function displayUserClasses(reservations) {
            const gridDiv = document.getElementById('my-classes-grid');
            gridDiv.innerHTML = '';
            
            const now = new Date();
            
            // Sort by date (upcoming first)
            reservations.sort((a, b) => {
                const dateA = parseFechaHora(a.fechaHora);
                const dateB = parseFechaHora(b.fechaHora);
                return dateA - dateB;
            });
            
            reservations.forEach((reservation, index) => {
                const classDate = parseFechaHora(reservation.fechaHora);
                
                if (!classDate) {
                    console.warn('Formato de fecha inválido:', reservation.fechaHora);
                    return;
                }
                
                // Determine if class is upcoming or past
                const isUpcoming = classDate >= now;
                
                // Format date and time
                const dateStr = classDate.toLocaleDateString('es-ES', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                const timeStr = classDate.toLocaleTimeString('es-ES', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                // Create class card
                const classCard = document.createElement('div');
                classCard.className = 'class-card';
                classCard.style.animationDelay = `${index * 0.1}s`;
                
                classCard.innerHTML = `
                    <div class="class-card-date">
                        <span class="class-card-date-icon">📅</span>
                        <span>${dateStr}</span>
                    </div>
                    <div class="class-card-time">
                        <span class="class-card-time-icon">🕐</span>
                        <span>${timeStr}</span>
                    </div>
                    ${reservation.notas ? `
                        <div class="class-card-info">
                            <strong>📝 Notas:</strong> ${reservation.notas}
                        </div>
                    ` : ''}
                    <div class="class-card-status ${isUpcoming ? 'upcoming' : 'past'}">
                        ${isUpcoming ? '✨ Próxima clase' : '✓ Clase completada'}
                    </div>
                `;
                
                gridDiv.appendChild(classCard);
            });
        }
        
        /**
         * Hide My Classes section
         */
        function hideUserClasses() {
            const myClassesSection = document.getElementById('my-classes-section');
            const greetingEl = document.getElementById('my-classes-greeting');
            myClassesSection.style.display = 'none';
            // Reset greeting to default
            greetingEl.textContent = '📚 Mis Clases';
        }


        // ========== REGLAS DE SEGURIDAD DE FIRESTORE ==========
        /*
         * INSTRUCCIONES: Copia y pega estas reglas en Firebase Console > Firestore Database > Rules
         * 
         * Estas reglas permiten:
         * - Lectura de la colección 'reservas' para el admin y para usuarios que lean sus propias reservas
         * - Escritura en 'reservas' SOLO para usuarios autenticados (request.auth != null)
         * - Lectura de 'usuarios' SOLO para admin@aura.com
         * - Escritura en 'usuarios' SOLO para usuarios autenticados
         * 
         * REGLAS DE FIRESTORE (copiar en Firebase Console):
         * 
         * rules_version = '2';
         * service cloud.firestore {
         *   match /databases/{database}/documents {
         *     // Colección de reservas
         *     match /reservas/{reservaId} {
         *       // Lectura: admin puede leer todo, usuarios pueden leer sus propias reservas
         *       allow read: if request.auth != null && 
         *                    (request.auth.token.email == 'admin@aura.com' || 
         *                     resource.data.email == request.auth.token.email);
         *       // Escritura solo para usuarios autenticados
         *       allow write: if request.auth != null;
         *     }
         *     
         *     // Colección de usuarios (perfiles)
         *     match /usuarios/{document=**} {
         *       // Lectura: admin puede leer todo, usuarios pueden leer su propio perfil
         *       // IMPORTANTE: Los usuarios DEBEN poder leer su perfil para recuperar su nombre
         *       allow read: if request.auth != null && 
         *                    (request.auth.token.email == 'admin@aura.com' || 
         *                     resource.data.email == request.auth.token.email);
         *       // Escritura solo para usuarios autenticados
         *       // IMPORTANTE: Los usuarios DEBEN poder escribir para guardar su perfil al registrarse
         *       allow write: if request.auth != null;
         *     }
         *     
         *     // Todas las demás colecciones: acceso denegado por defecto
         *     match /{document=**} {
         *       allow read, write: if false;
         *     }
         *   }
         * }
         * 
         * IMPORTANTE: Después de copiar estas reglas en Firebase Console,
         * haz clic en "Publicar" para aplicar los cambios.
         */

        // ========== INICIALIZACIÓN ==========
        
        /**
         * Cargar reservas y exponer función globalmente
         */
        window.loadReservationsFromFirestore = loadReservations;
        window.loadAdminCalendarReservations = loadAdminCalendarReservations;
        window.initAdminCalendar = initAdminCalendar;
        
        /**
         * Inicializar todo cuando el DOM esté listo
         */
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Inicializando sistema de autenticación y reservas...');
            
            // Configurar admin login y logout
            setupAdminLogin();
            setupLogout();
            
            // Observar cambios de autenticación
            setupAuthObserver();
            
            console.log('✅ Sistema de autenticación y reservas inicializado');
        });
    </script>

    <!-- ========== Hero Video Control Script ========== -->
    <script>
        // Control hero video playback (play from second 1 to second 25)
        // Enhanced for cross-device compatibility - removes play button on all devices
        document.addEventListener('DOMContentLoaded', function() {
            const heroVideo = document.getElementById('hero-video');
            // Delay before retrying play on pause (allows browser to settle)
            const PAUSE_RETRY_DELAY_MS = 100;
            
            if (heroVideo) {
                // Track if video loaded successfully and if play was already attempted
                let videoLoaded = false;
                let playAttempted = false;
                
                // Remove controls attribute programmatically (ensures no controls appear)
                heroVideo.controls = false;
                heroVideo.setAttribute('webkit-playsinline', 'true');
                heroVideo.setAttribute('x-webkit-airplay', 'deny');
                
                // Set start time to 1 second when video is loaded
                heroVideo.addEventListener('loadedmetadata', function() {
                    videoLoaded = true;
                    heroVideo.currentTime = 1;
                    console.log('✅ Video loaded successfully');
                    // Ensure video plays after metadata loads
                    attemptPlay();
                });
                
                // Also try on canplay event (consolidated from multiple events)
                heroVideo.addEventListener('canplay', function() {
                    if (!playAttempted) {
                        attemptPlay();
                    }
                });
                
                // Monitor playback and loop from second 1 to 25
                heroVideo.addEventListener('timeupdate', function() {
                    // If video reaches 25 seconds or beyond, reset to 1 second
                    if (heroVideo.currentTime >= 25) {
                        heroVideo.currentTime = 1;
                    }
                });
                
                // If video is paused for any reason, try to resume
                heroVideo.addEventListener('pause', function() {
                    // Only try to resume if the video was loaded and is within playback range
                    if (videoLoaded && heroVideo.currentTime >= 1 && heroVideo.currentTime < 25) {
                        setTimeout(function() {
                            attemptPlay();
                        }, PAUSE_RETRY_DELAY_MS);
                    }
                });
                
                // Function to attempt playing the video with fallback
                function attemptPlay() {
                    if (heroVideo.paused) {
                        playAttempted = true;
                        const playPromise = heroVideo.play();
                        if (playPromise !== undefined) {
                            playPromise.then(function() {
                                console.log('✅ Video autoplay successful');
                            }).catch(function(error) {
                                console.log('Video autoplay was prevented:', error.message);
                                // Try again on user interaction
                                setupUserInteractionFallback();
                            });
                        }
                    }
                }
                
                // Setup fallback for browsers that require user interaction
                function setupUserInteractionFallback() {
                    const startPlayback = function() {
                        attemptPlay();
                        // Remove listeners after first interaction
                        document.removeEventListener('touchstart', startPlayback);
                        document.removeEventListener('click', startPlayback);
                        document.removeEventListener('scroll', startPlayback);
                    };
                    
                    document.addEventListener('touchstart', startPlayback, { passive: true, once: true });
                    document.addEventListener('click', startPlayback, { once: true });
                    document.addEventListener('scroll', startPlayback, { passive: true, once: true });
                }
                
                // Detect video load errors
                heroVideo.addEventListener('error', function(e) {
                    console.warn('⚠️ Video failed to load');
                    console.warn('📁 Expected location: videoaura155.mp4');
                    console.warn('📖 Instructions: See DOWNLOAD_VIDEO_FIRST.md or video-missing.html');
                    console.warn('🔗 Download from: https://www.pexels.com/video/8746842/download/');
                    
                    // Show a subtle notification to developers
                    if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                        setTimeout(function() {
                            if (!videoLoaded) {
                                console.log('%c🎬 AURA Studio - Video Missing', 'font-size: 16px; font-weight: bold; color: #EFE9E1;');
                                console.log('%cThe background video is not playing because the file is missing.', 'font-size: 14px;');
                                console.log('%cTo fix this:', 'font-size: 14px; font-weight: bold;');
                                console.log('%c1. Download: https://www.pexels.com/video/8746842/download/', 'font-size: 13px;');
                                console.log('%c2. Save as: videoaura155.mp4', 'font-size: 13px;');
                                console.log('%c3. Or run: ./download-video.sh or python download-video.py', 'font-size: 13px;');
                                console.log('%cFor detailed instructions, open: video-missing.html', 'font-size: 13px; font-style: italic;');
                            }
                        }, 1000);
                    }
                });
                
                // Ensure video starts at second 1
                heroVideo.currentTime = 1;
                
                // Initial play attempt
                attemptPlay();
                
                // Check if video is actually loading after a delay
                setTimeout(function() {
                    if (!videoLoaded && heroVideo.readyState === 0) {
                        console.warn('⚠️ Video may be missing or failed to load');
                        console.log('%c📖 Open video-missing.html for instructions', 'font-size: 14px; color: #2196F3; font-weight: bold;');
                    }
                }, 2000);
            }
        });
    </script>

    <!-- ========== Page Loader Script ========== -->
    <script>
        // Hide loader after 3 seconds on page load or refresh
        window.addEventListener('load', function() {
            setTimeout(function() {
                const loader = document.getElementById('page-loader');
                if (loader) {
                    // Add fade-out class
                    loader.classList.add('fade-out');
                    
                    // Remove from DOM after fade-out animation completes
                    setTimeout(function() {
                        loader.style.display = 'none';
                    }, 500); // Match the CSS transition duration
                }
            }, 3000); // 3 seconds delay
        });
    </script>

    <!-- ========== Custom Alert Modal ========== -->
    <div id="custom-alert-overlay" class="custom-alert-overlay">
        <div id="custom-alert-card" class="custom-alert-card">
            <span id="custom-alert-icon" class="custom-alert-icon">✓</span>
            <h3 id="custom-alert-title" class="custom-alert-title">Título</h3>
            <p id="custom-alert-message" class="custom-alert-message">Mensaje</p>
            <button type="button" id="custom-alert-button" class="custom-alert-button">Aceptar</button>
        </div>
    </div>

    <!-- ========== Custom Alert Script ========== -->
    <script>
        /**
         * Custom Alert System - Beautiful pearl/white styled cards
         * Replaces native browser alert() with styled modal cards
         */
        function showCustomAlert(message, type = 'info', title = '') {
            const overlay = document.getElementById('custom-alert-overlay');
            const card = document.getElementById('custom-alert-card');
            const icon = document.getElementById('custom-alert-icon');
            const titleEl = document.getElementById('custom-alert-title');
            const messageEl = document.getElementById('custom-alert-message');
            const button = document.getElementById('custom-alert-button');

            // Set icon and title based on type
            let iconChar = '✓';
            let defaultTitle = 'Notificación';
            
            // Remove previous type classes
            card.classList.remove('custom-alert-success', 'custom-alert-error', 'custom-alert-warning', 'custom-alert-info');
            
            if (type === 'success') {
                iconChar = '✓';
                defaultTitle = '¡Éxito!';
                card.classList.add('custom-alert-success');
            } else if (type === 'error') {
                iconChar = '✕';
                defaultTitle = 'Error';
                card.classList.add('custom-alert-error');
            } else if (type === 'warning') {
                iconChar = '⚠';
                defaultTitle = 'Atención';
                card.classList.add('custom-alert-warning');
            } else if (type === 'info') {
                iconChar = 'ℹ';
                defaultTitle = 'Información';
                card.classList.add('custom-alert-info');
            }

            icon.textContent = iconChar;
            titleEl.textContent = title || defaultTitle;
            messageEl.textContent = message;

            // Show overlay
            overlay.style.display = 'flex';

            // Button click handler
            const closeAlert = () => {
                overlay.style.display = 'none';
                button.removeEventListener('click', closeAlert);
                overlay.removeEventListener('click', outsideClickHandler);
            };

            // Close on button click
            button.addEventListener('click', closeAlert);

            // Close on overlay click (outside card)
            const outsideClickHandler = (e) => {
                if (e.target === overlay) {
                    closeAlert();
                }
            };
            overlay.addEventListener('click', outsideClickHandler);
        }

        // Override native alert function
        window.alert = function(message) {
            // Determine alert type based on message content
            let type = 'info';
            let title = '';

            if (message.includes('✅') || message.includes('Completadas') || message.includes('exitoso') || message.includes('agregada')) {
                type = 'success';
                title = '¡Éxito!';
            } else if (message.includes('❌') || message.includes('Error')) {
                type = 'error';
                title = 'Error';
            } else if (message.includes('⚠️') || message.includes('Atención') || message.includes('Debes')) {
                type = 'warning';
                title = 'Atención';
            }

            showCustomAlert(message, type, title);
        };
    </script>

    <!-- ========== MERCADO PAGO - FIX DEFINITIVO 2025 (100% RETORNO) ========== -->
    <script>
        // CONFIGURACIÓN DE PRODUCCIÓN - Token movido al backend por seguridad
        const BACKEND_URL = '/api/create-preference';
        const RETURN_URL = 'https://aura-eta-five.vercel.app';

        // NUEVO FLUJO: Attach click handlers to all "Agendar Clase" buttons
        document.addEventListener('DOMContentLoaded', () => {
            // Attach click handlers to all "Agendar Clase" buttons
            const planButtons = document.querySelectorAll('.plan-btn');
            planButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    e.preventDefault();
                    
                    // Extract clases from data-title (e.g., "1 Clases" -> 1)
                    const dataTitle = button.getAttribute('data-title');
                    if (!dataTitle) {
                        console.error('Missing data-title attribute on button');
                        return;
                    }
                    const match = dataTitle.match(/\d+/);
                    if (!match) {
                        console.error('Invalid data-title format (expected number):', dataTitle);
                        return;
                    }
                    const clases = parseInt(match[0], 10);
                    if (isNaN(clases) || clases <= 0) {
                        console.error('Invalid number of classes (must be positive):', clases);
                        return;
                    }
                    
                    // Extract precio from data-price
                    const dataPrecio = button.getAttribute('data-price');
                    if (!dataPrecio) {
                        console.error('Missing data-price attribute on button');
                        return;
                    }
                    const precio = parseInt(dataPrecio, 10);
                    if (isNaN(precio) || precio <= 0) {
                        console.error('Invalid price (must be positive):', precio);
                        return;
                    }
                    
                    console.log(`Plan button clicked: ${clases} clases, $${precio}`);
                    // NUEVO FLUJO: Llamar directamente a selectPlan (muestra calendario inmediatamente)
                    window.selectPlan(clases, precio);
                });
            });
            
            // Setup time selection modal cancel button
            const timeCancelBtn = document.getElementById('time-cancel');
            if (timeCancelBtn) {
                timeCancelBtn.addEventListener('click', () => {
                    document.getElementById('time-selection-modal').style.display = 'none';
                    document.body.style.overflow = ''; // Restore scrolling
                });
            }
        });

        async function crearPreferenciaYRedirigir(nombre, telefono) {
            // Validar que tenemos los datos necesarios
            if (!nombre || !telefono) {
                console.error('❌ Faltan datos del cliente:', { nombre, telefono });
                alert('❌ Error: Faltan datos del cliente. Por favor, completa el formulario.');
                return;
            }
            
            // Usar selectedPlan para obtener clases y precio
            const classes = selectedPlan.classes || parseInt(localStorage.getItem('tempPlanClasses') || '1');
            const price = selectedPlan.price || parseInt(localStorage.getItem('tempPlanPrice') || '150');
            
            // Validar que hay clases y precio válidos
            if (classes <= 0 || price <= 0) {
                console.error('❌ Plan inválido:', { classes, price });
                alert('❌ Error: Plan no válido. Por favor, selecciona un plan nuevamente.');
                return;
            }
            
            // Mostrar indicador de carga
            console.log(`⏳ Procesando pago de ${classes} clase${classes > 1 ? 's' : ''} por $${price}...`);

            try {
                // Llamar al backend seguro en lugar de exponer el token
                const res = await fetch(BACKEND_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        title: `${classes} clase${classes > 1 ? 's' : ''} en Aura Studio`,
                        price: price,
                        payer_name: nombre,
                        payer_phone: telefono
                    })
                });
                
                // Verificar si la respuesta es exitosa
                if (!res.ok) {
                    const errorData = await res.json().catch(() => ({}));
                    console.error('❌ Error del servidor:', res.status, errorData);
                    
                    if (res.status === 400) {
                        alert(`❌ Datos inválidos: ${errorData.details || errorData.error || 'Verifica tus datos'}`);
                    } else if (res.status === 500) {
                        alert('❌ Error del servidor. Por favor, intenta nuevamente en unos minutos.');
                    } else {
                        alert(`❌ Error al procesar pago (${res.status}). Por favor, intenta nuevamente.`);
                    }
                    return;
                }
                
                const data = await res.json();
                if (!data.init_point) {
                    console.error('❌ Error en respuesta del servidor:', data);
                    alert('❌ Error al crear preferencia de pago. Por favor, intenta nuevamente.');
                    return;
                }
                
                console.log('✅ Preferencia creada:', data.preference_id || 'OK');
                console.log('🔗 Redirigiendo a MercadoPago...');
                
                // Redirigir a MercadoPago
                location.href = data.init_point;
            } catch (e) {
                console.error('❌ Error al procesar pago:', e);
                
                // Verificar si es un error de red
                if (e.name === 'TypeError' && e.message.includes('fetch')) {
                    alert('❌ Error de conexión. Verifica tu internet e intenta nuevamente.');
                } else {
                    alert('❌ Error al procesar pago. Por favor, intenta nuevamente.');
                }
            }
        }

        // Constants for Firebase initialization
        const MAX_FIREBASE_INIT_ATTEMPTS = 20;
        const FIREBASE_POLLING_INTERVAL_MS = 500;
        
        // DETECTOR DE RETORNO MEJORADO - Maneja callback de Mercado Pago
        // NUEVO FLUJO: Guardar todas las reservas en Firestore al regresar del pago
        // Flag para evitar ejecución múltiple
        let paymentReturnProcessed = false;
        
        async function detectarRetorno() {
            // Evitar doble procesamiento (DOMContentLoaded + load)
            if (paymentReturnProcessed) {
                console.log('⏭️ Retorno ya procesado, saltando...');
                return;
            }
            
            // Usar la función helper para verificar si es un retorno de pago
            if (!isPaymentReturnFromMercadoPago()) {
                return; // No hay parámetros de pago, no hacer nada
            }
            
            const params = new URLSearchParams(location.search);
            
            // Verificar estados de pago de MercadoPago
            const status = params.get('status');
            const paymentId = params.get('payment_id') || params.get('collection_id');
            const hasSuccessParam = params.has('success') && params.get('success') === '1';
            
            // Determinar el estado del pago
            const isApproved = status === 'approved' || hasSuccessParam;
            const isPending = status === 'pending' || status === 'in_process';
            const isRejected = status === 'rejected' || (params.has('error') && params.get('error') === '1');
            
            // Solo procesar si hay parámetros de pago
            if (!isApproved && !isPending && !isRejected && !paymentId) {
                return; // No hay parámetros de pago, no hacer nada
            }
            
            // Marcar como procesado para evitar doble ejecución
            paymentReturnProcessed = true;
            console.log('💳 Retorno de Mercado Pago detectado:', { status, paymentId, isApproved, isPending, isRejected });
            
            // Manejar pago rechazado
            if (isRejected) {
                console.log('❌ Pago rechazado');
                history.replaceState({}, document.title, location.pathname);
                alert('❌ El pago fue rechazado.\n\nPor favor, verifica tu método de pago e intenta nuevamente.\n\nTus reservas temporales se mantienen.');
                return;
            }
            
            // Manejar pago pendiente
            if (isPending) {
                console.log('⏳ Pago pendiente');
                history.replaceState({}, document.title, location.pathname);
                alert('⏳ Tu pago está siendo procesado.\n\nTe notificaremos cuando se confirme.\n\nNo cierres esta ventana.');
                // No limpiar localStorage, ya que el pago aún no está confirmado
                return;
            }
            
            // Solo continuar si el pago fue aprobado
            if (!isApproved) {
                console.log('⚠️ Estado de pago no reconocido:', status);
                history.replaceState({}, document.title, location.pathname);
                return;
            }
            
            console.log('✅ Pago aprobado, procesando reservas...');
            
            // 1. Limpiar URL inmediatamente (quitar parámetros de pago)
            history.replaceState({}, document.title, location.pathname);
            console.log('🧹 URL limpiada');
            
            // 2. Recuperar reservas temporales de localStorage
            const tempReservationsStr = localStorage.getItem('tempReservations');
            if (!tempReservationsStr) {
                console.error('❌ No hay reservas temporales en localStorage');
                alert('⚠️ No se encontraron reservas pendientes.\n\nPor favor, selecciona un plan nuevamente.');
                return;
            }
            
            let tempData;
            try {
                tempData = JSON.parse(tempReservationsStr);
            } catch (e) {
                console.error('❌ Error al parsear reservas temporales:', e);
                alert('❌ Error al recuperar reservas. Por favor, contacta con soporte.');
                return;
            }
            
            // Validar estructura de datos
            const { reservations, userInfo } = tempData;
            if (!reservations || !Array.isArray(reservations) || reservations.length === 0) {
                console.error('❌ Estructura de reservas inválida:', tempData);
                alert('❌ Error: Reservas no válidas. Por favor, contacta con soporte.');
                return;
            }
            
            const nombre = userInfo?.nombre || localStorage.getItem('userNombre') || 'Cliente';
            const telefono = userInfo?.telefono || localStorage.getItem('userTelefono') || '';
            
            console.log(`📋 Reservas recuperadas: ${reservations.length} clases para ${nombre}`);
            
            // 3. Mostrar mensaje de éxito inicial
            alert(`¡Pago recibido, ${nombre}!\n\nGuardando tus ${reservations.length} clases...`);
            
            // 4. Esperar a que Firebase esté listo
            const waitForFirebase = async () => {
                let attempts = 0;
                
                while (attempts < MAX_FIREBASE_INIT_ATTEMPTS) {
                    if (window.firebaseReady && window.db && typeof window.saveReservationToFirestore === 'function') {
                        return true;
                    }
                    await new Promise(resolve => setTimeout(resolve, FIREBASE_POLLING_INTERVAL_MS));
                    attempts++;
                    console.log(`⏳ Esperando Firebase... (${attempts}/${MAX_FIREBASE_INIT_ATTEMPTS})`);
                }
                return false;
            };
            
            const firebaseReady = await waitForFirebase();
            if (!firebaseReady) {
                console.error('❌ Firebase no está listo');
                // NO limpiar localStorage para que el usuario pueda reintentar
                alert('❌ Error: Sistema de reservas no disponible.\n\nTus reservas están guardadas temporalmente.\nPor favor, recarga la página para reintentar o contacta con soporte.');
                return;
            }
            
            console.log('✅ Firebase listo, guardando reservas...');
            
            // 5. Guardar todas las reservas en Firestore
            const savedReservations = [];
            const failedReservations = [];
            
            for (let i = 0; i < reservations.length; i++) {
                const reservation = reservations[i];
                try {
                    console.log(`💾 Guardando reserva ${i + 1}/${reservations.length}...`, reservation);
                    
                    // Validar datos de la reserva antes de guardar
                    if (!reservation.nombre || !reservation.telefono || !reservation.fechaHora) {
                        console.error(`❌ Reserva ${i + 1} tiene datos incompletos:`, reservation);
                        failedReservations.push(reservation);
                        continue;
                    }
                    
                    const reservaId = await window.saveReservationToFirestore(
                        reservation.nombre,
                        reservation.telefono,
                        reservation.fechaHora, // ISO format: YYYY-MM-DDTHH:mm:ss
                        '' // notas vacías por ahora
                    );
                    
                    savedReservations.push(reservaId);
                    console.log(`✅ Reserva ${i + 1} guardada con ID:`, reservaId);
                } catch (error) {
                    console.error(`❌ Error al guardar reserva ${i + 1}:`, error);
                    failedReservations.push(reservation);
                }
            }
            
            // 6. Solo limpiar datos temporales si se guardó al menos una reserva
            if (savedReservations.length > 0) {
                localStorage.removeItem('tempReservations');
                localStorage.removeItem('tempPlanClasses');
                localStorage.removeItem('tempPlanPrice');
                localStorage.removeItem('planClases');
                localStorage.removeItem('planPrecio');
                console.log('🧹 Datos temporales limpiados');
            }
            
            // 7. Mostrar resultado
            if (savedReservations.length === reservations.length) {
                // Todas guardadas exitosamente
                alert(`✅ ¡Pago recibido! Tus ${savedReservations.length} clases están confirmadas.\n\nGracias ${nombre}, nos vemos pronto!`);
                
                // 8. Recargar "Mis Clases" si el usuario está logueado
                if (telefono && typeof window.loadUserClasses === 'function') {
                    console.log('📚 Recargando "Mis Clases"...');
                    try {
                        await window.loadUserClasses(telefono);
                    } catch (e) {
                        console.error('Error al cargar clases del usuario:', e);
                    }
                }
                
                // 9. Recargar panel admin si está disponible
                if (window.isAdmin && typeof window.loadReservationsFromFirestore === 'function') {
                    console.log('👨‍💼 Recargando panel admin...');
                    try {
                        await window.loadReservationsFromFirestore();
                    } catch (e) {
                        console.error('Error al recargar panel admin:', e);
                    }
                }
                
                // 10. Scroll a "Mis Clases" si está visible
                const myClassesSection = document.getElementById('my-classes-section');
                if (myClassesSection && myClassesSection.style.display !== 'none') {
                    setTimeout(() => {
                        myClassesSection.scrollIntoView({ behavior: 'smooth' });
                    }, 1000);
                }
            } else if (savedReservations.length > 0) {
                // Algunas guardadas
                alert(`⚠️ Pago recibido\n\n${savedReservations.length} de ${reservations.length} clases guardadas correctamente.\n\n${failedReservations.length} clases fallaron.\n\nPor favor, contacta con soporte.`);
            } else {
                // Ninguna guardada - NO limpiar localStorage
                alert('❌ Error al guardar las reservas.\n\nTu pago fue recibido pero hubo un error técnico.\n\nPor favor, recarga la página para reintentar o contacta con soporte inmediatamente.');
            }
        }

        // Ejecutar al cargar
        document.addEventListener('DOMContentLoaded', detectarRetorno);
        window.addEventListener('load', detectarRetorno);
    </script>

</body>
</html>
